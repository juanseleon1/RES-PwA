<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Registering types in the type system &mdash; Aldebaran 2.5.9.8-r3 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.5.9.8-r3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Aldebaran 2.5.9.8-r3 documentation" href="../../../index.html" />
    <link rel="up" title="Hands-on Guide" href="index.html" />
    <link rel="next" title="Asynchronous operations" href="cxx-async.html" />
    <link rel="prev" title="C++ - How to write a qimessaging service" href="cxx-service.html" />
 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115894784-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115894784-1');
</script>

<script type="text/javascript" src="https://cloud.aldebaran-robotics.com/static/js/topbar.js"></script>
<style>
div#hd::after {
  
  
  content: 'NAOqi 2.5';
  
  
  
  position: absolute;
  margin-top: -54px;
  right: -4px;
  font-size: 125%;
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
  -o-transform: rotate(45deg);
  transform: rotate(45deg);
  }
</style>
<script>

$(window).ready(function () {

    //Aldebaran Top bar
     var barLinks = [];
     barLinks.push({'name':'Aldebaran Site', 'url':'http://www.aldebaran-robotics.com', 'click':'', 'img':'https://cloud.aldebaran-robotics.com/static/img/aldeb.png'});
     barLinks.push({'name':'Documentation', 'url':'../../../index.html', 'click':"", 'img':''});
     function ShowBar(name, email, usertype) {
        var barParams = {
            'name'    : name,
            'email'   : email,
            'usertype': usertype,
            'loginfct': "FctLogin"
        }
        try { InitTopBar(barParams, barLinks); } catch (e) { console.log('Top Bar Init Failed'); }
    }
    ShowBar();

    var width_label = 0;
    $('dl.function-index dt > span').each(function () {
        $(this).css('width', 'auto');
        width_label = Math.max(width_label, $(this).width());
    }).width(width_label + 30);
    $('.sig-paren').width('auto');

    // first level navigation

    var buttonIds = [".naoqi", "pepper", "nao", "romeo"];
    for(id in buttonIds){
        $(id).removeClass("active");
    }
    //Aldebaran project
    if ($('.toctree-l1.current a').text().indexOf("Romeo ")==0){
        $(".romeo").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Pepper ")==0){
        $(".pepper").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("NAO ")==0){
        $(".nao").toggleClass('active');
    }
    else if($('.toctree-l1.current a').text().indexOf("NAOqi ")==0){
        $(".naoqi").toggleClass('active');
    }

    //qibuild project
    if ($('.toctree-l1.current a').text().indexOf("Welcome to qiBuild documentation !")==0){
        $(".beginner").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Advanced qibuild usage")==0){
        $(".advanced").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Hacking qiBuild")==0){
        $(".hacking").toggleClass('active');
    }

    // add "On this page", add cssClasses
    if($('.yui-g .section h1').length > 0){
        $('.yui-g .section h1:first').addClass("titleWrapper");
        $('.yui-g .section h1:first').after($("#on-this-page").html())
    }
    else if($('.yui-g .section h2').length > 0){
        $('.yui-g .section h2:first').addClass("titleWrapper");
        $('.yui-g .section h2:first').after($("#on-this-page").html())
    }
    //remove first element on this page
    if($("#on-this-page").length > 0){
        var doms = $(".yui-g .section :first").nextUntil("#toc-list");
        doms = doms.add($("#toc-list"));
        doms.wrapAll('<div class="iNavWrapper"></div>');
        $("#toc-list ul li a:first").remove()
        $("#toc-list ul:first").replaceWith($("#toc-list ul li").html())
    }
    $("#toc-list").hide();
    $("#otp-link").click(function(){
        $("#toc-list").slideToggle();
        if($("h2#otp-link").hasClass("change-before")){
            $("h2#otp-link").removeClass("change-before")
        }
        else{
            $("h2#otp-link").addClass("change-before")
        }
    });

    if($("a.current.reference.internal").length>0){
        var left = $("a.current.reference.internal").position().left-1;
        var width = $("a.current.reference.internal").width();
        var offset = 51;
        var sidebarWidth = 339;
        var right = sidebarWidth - (left + width + offset);
        if($("a.current.reference.internal").height() <= 15){
            $("a.current.reference.internal").css("white-space","nowrap");
            $("a.current.reference.internal").css({"backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        else{
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
            left = $("a.current.reference.internal").position().left-1;
            width = $("a.current.reference.internal").width();
            right = sidebarWidth - (left + width + offset);
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        $("a.current.reference.internal").parent().css("list-style-type","none");
    }

    //back to top
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700;
    //grab the "back to top" link
    var back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
        //back to top button
        ( $(this).scrollTop() > offset ) ? back_to_top.addClass('cd-is-visible') : back_to_top.removeClass('cd-is-visible cd-fade-out');
        if( $(this).scrollTop() > offset_opacity ) {
            back_to_top.addClass('cd-fade-out');
        }
    });

    //smooth scroll to top
    back_to_top.click(function(event){
        event.preventDefault();
        $('body,html').animate({
            scrollTop: 0 ,
        }, scroll_top_duration
        );
    });
    //add show source button

    //replace "go" with "search"
    $("#searchbox form input[type=submit]").val("Search")

    //trigger click on version triangle to jump to whats new
    $("#hd").click(function(e){if(e.pageX >= this.offsetWidth && e.pageY<120){$(".whatsnew")[0].click()}})
})

</script>


  </head>
  <body role="document">

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      
      <h1><a href="../../../index.html">SoftBank Robotics documentation</a>
      
      
      <span><a class="whatsnew" href="../../../news/index.html" >
      
          What's new in NAOqi 2.5?
      
      </a></span>
      
      </h1>
      <div id="global-nav">
        
        <a class="naoqi" title="NAOqi Developer guide" href="../../../index_dev_guide.html">NAOqi</a>
        <a class="pepper" title="Pepper documentation" href="../../../home_pepper.html">Pepper</a>
        <a class="nao" title="NAO documentation" href="../../../home_nao.html">NAO</a>
        <a class="romeo" title="Romeo Documentation" href="../../../home_romeo.html">Romeo</a>
        
        
        
        <div class="nav">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script></div>
      </div>

    </div>
    <main class="cd-container">
        <div id="bd">
          <div id="yui-main">
            <div class="yui-b">
              <div class="yui-g" id="dev-libqi-guide-cxx-register-types">
                
  <div class="section" id="registering-types-in-the-type-system">
<span id="guide-cxx-register-types"></span><h1>Registering types in the type system<a class="headerlink" href="#registering-types-in-the-type-system" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>For types to be available in the type system and allow them to be type-erased,
sent over the network or through signals, each one of them needs to be
registered in the type system.</p>
<p>Most of these registration can be done through macros. It is very important
that you call macros made to be used in .cpp only in .cpp files, these macros
should be processed in a single translation unit.</p>
<p>All registration classes and macros are in:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;qi/anyobject.hpp&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="structures">
<h2>Structures<a class="headerlink" href="#structures" title="Permalink to this headline">¶</a></h2>
<p>To register a structure, you need to call the macro <cite>QI_TYPE_STRUCT()</cite> in the
corresponding .hpp file.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// point.hpp</span>

<span class="k">namespace</span> <span class="n">Graph</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="n">Point</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="n">QI_TYPE_STRUCT</span><span class="p">(</span><span class="n">Graph</span><span class="o">::</span><span class="n">Point</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
<p>Or you can do the register in the .cpp:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// point.cpp</span>

<span class="c1">// call this outside of any namespace</span>
<span class="n">QI_TYPE_STRUCT_REGISTER</span><span class="p">(</span><span class="n">Graph</span><span class="o">::</span><span class="n">Point</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="using-pimpl-in-structures">
<h3>Using PIMPL in structures<a class="headerlink" href="#using-pimpl-in-structures" title="Permalink to this headline">¶</a></h3>
<p>Sometime, you have a structure of data, but you don&#8217;t want the user to access
it directly because you want to constrain values or to updates multiple values
at the same time so that the structure stays coherent.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Vector</span> <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">setValues</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">_x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
      <span class="n">_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
      <span class="n">_length</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">float</span> <span class="n">length</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_length</span><span class="p">;</span> <span class="p">}</span>
    <span class="c1">// ...</span>

  <span class="k">private</span><span class="o">:</span>
    <span class="kt">int</span> <span class="n">_x</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">_y</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">_length</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// How can I register this??</span>
</pre></div>
</div>
<p>You can&#8217;t register this struct because _x, _y and _length are private and you
don&#8217;t want to make them public because the user could change _x and _y without
changing _length.</p>
<p>To register that to the type system, you need to use pimpl:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// vector.hpp</span>

<span class="k">class</span> <span class="nc">Vector</span> <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="n">Vector</span><span class="p">();</span>
    <span class="c1">// you need a copy constructor because qitype makes copies</span>
    <span class="n">Vector</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">);</span>
    <span class="kt">void</span> <span class="nf">setValues</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
    <span class="kt">float</span> <span class="nf">length</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>

  <span class="k">private</span><span class="o">:</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">scoped_ptr</span><span class="o">&lt;</span><span class="k">struct</span> <span class="n">VectorPrivate</span><span class="o">&gt;</span> <span class="n">_p</span><span class="p">;</span>

    <span class="c1">// you need this for later</span>
    <span class="k">friend</span> <span class="k">struct</span> <span class="n">VectorPrivate</span><span class="o">*</span> <span class="nf">vectorPrivateAccess</span><span class="p">(</span><span class="n">Vector</span><span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// vector.cpp</span>

<span class="k">struct</span> <span class="n">VectorPrivate</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">_x</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">_y</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">_length</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Vector</span><span class="o">::</span><span class="n">Vector</span><span class="p">()</span> <span class="o">:</span> <span class="n">_p</span><span class="p">(</span><span class="k">new</span> <span class="n">VectorPrivate</span><span class="p">)</span> <span class="p">{}</span>
<span class="n">Vector</span><span class="o">::</span><span class="n">Vector</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector</span><span class="o">&amp;</span> <span class="n">other</span><span class="p">)</span> <span class="o">:</span> <span class="n">_p</span><span class="p">(</span><span class="k">new</span> <span class="n">VectorPrivate</span><span class="p">(</span><span class="o">*</span><span class="n">other</span><span class="p">.</span><span class="n">_p</span><span class="p">))</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Then you can register the private part of the struct and tell qitype how to
access it:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">VectorPrivate</span><span class="o">*</span> <span class="nf">vectorPrivateAccess</span><span class="p">(</span><span class="n">Vector</span><span class="o">*</span> <span class="n">vector</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">vector</span><span class="o">-&gt;</span><span class="n">_p</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// call these outside of any namespace</span>
<span class="n">QI_TYPE_STRUCT_REGISTER</span><span class="p">(</span><span class="n">VectorPrivate</span><span class="p">,</span> <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">_length</span><span class="p">);</span>

<span class="n">QI_TYPE_STRUCT_BOUNCE_REGISTER</span><span class="p">(</span><span class="n">Vector</span><span class="p">,</span> <span class="n">VectorPrivate</span><span class="p">,</span> <span class="n">vectorPrivateAccess</span><span class="p">);</span>
</pre></div>
</div>
<p>Every time you transfer a Vector, qimessaging will also transfer its private
part and no one can access it without using the accessors.</p>
</div>
<div class="section" id="struct-extension">
<span id="cxx-register-types-struct-extension"></span><h3>Struct extension<a class="headerlink" href="#struct-extension" title="Permalink to this headline">¶</a></h3>
<p>It is sometime necessary during the lifetime of software to update the structs
that are exchanged. Such updates consist usually in adding or removing fields
from structures and possibly filling them with data from other fields.</p>
<div class="section" id="adding-or-dropping-fields-automatically">
<h4>Adding or dropping fields automatically<a class="headerlink" href="#adding-or-dropping-fields-automatically" title="Permalink to this headline">¶</a></h4>
<p>There are helper macros that allow saying that a field has been added or
removed from a structure. If you just add or remove fields, when two versions of
your program try to communicate, it will trigger errors.</p>
<p>Let&#8217;s say that you update the structure Cat and you
want to drop the field hairQuality and are a new field power.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// your structure before</span>
<span class="k">struct</span> <span class="n">Cat</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">eyesColor</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">largeEars</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">hairQuality</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">QI_TYPE_STRUCT</span><span class="p">(</span><span class="n">Cat</span><span class="p">,</span> <span class="n">eyesColor</span><span class="p">,</span> <span class="n">largeEars</span><span class="p">,</span> <span class="n">hairQuality</span><span class="p">)</span>

<span class="c1">// your structure after</span>
<span class="k">struct</span> <span class="n">Cat</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">eyesColor</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">largeEars</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">power</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">QI_TYPE_STRUCT</span><span class="p">(</span><span class="n">Cat</span><span class="p">,</span> <span class="n">eyesColor</span><span class="p">,</span> <span class="n">largeEars</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>
</pre></div>
</div>
<p>If an old version of your program tries to call a new version of your program
over the network, there will be a call error when it tries to transfer the Cat
structure because the signature doesn&#8217;t match.</p>
<p>libqi provides the macros to handle these cases. The firsts are
<cite>QI_TYPE_STRUCT_EXTENSION_DROPPED_FIELDS</cite> and
<cite>QI_TYPE_STRUCT_EXTENSION_ADDED_FIELDS</cite> and allow simply adding or dropping
fields. They must be called in your new program, before the register macro, like
this:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// you can specify multiple arguments to these two macros</span>
<span class="n">QI_TYPE_STRUCT_EXTENSION_DROPPED_FIELDS</span><span class="p">(</span><span class="n">Cat</span><span class="p">,</span> <span class="s">&quot;hairQuality&quot;</span><span class="p">)</span>
<span class="n">QI_TYPE_STRUCT_EXTENSION_ADDED_FIELDS</span><span class="p">(</span><span class="n">Cat</span><span class="p">,</span> <span class="s">&quot;power&quot;</span><span class="p">)</span>
<span class="n">QI_TYPE_STRUCT</span><span class="p">(</span><span class="n">Cat</span><span class="p">,</span> <span class="n">eyesColor</span><span class="p">,</span> <span class="n">largeEars</span><span class="p">,</span> <span class="n">power</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, when an old version of the struct is sent where a new version is
expected, libqi will allow the hairQuality field to be dropped and will
value-initialize the power field (like <code class="docutils literal"><span class="pre">T()</span></code>).</p>
<p>This also allows sending structures the other way. When a new structure is sent
to something that expects an old one, libqi will allow the power field to be
dropped and will value-initialize the hairQuality field.</p>
</div>
<div class="section" id="adding-or-dropping-fields-manually">
<h4>Adding or dropping fields manually<a class="headerlink" href="#adding-or-dropping-fields-manually" title="Permalink to this headline">¶</a></h4>
<p>Sometimes you may need a more complex behavior, like filling new fields
according to the values of the dropped fields, or dropping fields only when they
have some special value. Let&#8217;s take the latter as an example.</p>
<p>Let&#8217;s have a color structure:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">struct</span> <span class="n">Color</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">g</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">QI_TYPE_STRUCT</span><span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>And we want to update that structure and add an alpha field:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">struct</span> <span class="n">Color</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">g</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">QI_TYPE_STRUCT</span><span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, we want that, when an old Color is sent, the <code class="docutils literal"><span class="pre">a</span></code> field is filled with the
value 255 in the new Color we receive. In the other way, when sending a new
Color, it can be converted to Color only if the value of <code class="docutils literal"><span class="pre">a</span></code> is 255. If the
value is different from that, we are sending a color that is not supported by
the old program and we want the conversion to fail.</p>
<p>To do that, it is possible to provide two handlers that will be called whenever
a conversion is necessary. These handlers must then check that the conversion is
possible and attempt it.</p>
<p>The signature of these handlers is the following:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="kt">bool</span> <span class="nf">handler</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="o">::</span><span class="n">qi</span><span class="o">::</span><span class="n">AnyValue</span><span class="o">&gt;&amp;</span> <span class="n">fields</span><span class="p">,</span>
             <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">qi</span><span class="o">::</span><span class="n">TypeInterface</span><span class="o">*&gt;&gt;&amp;</span> <span class="n">missing</span><span class="p">,</span>
             <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="o">::</span><span class="n">qi</span><span class="o">::</span><span class="n">AnyReference</span><span class="o">&gt;&amp;</span> <span class="n">droppedFields</span><span class="p">);</span>
</pre></div>
</div>
<p>When a conversion is attempted, the fields that haven&#8217;t changed are filled in
<code class="docutils literal"><span class="pre">fields</span></code>. In our example, <code class="docutils literal"><span class="pre">fields</span></code> will contain <code class="docutils literal"><span class="pre">r</span></code>, <code class="docutils literal"><span class="pre">g</span></code> and <code class="docutils literal"><span class="pre">b</span></code> with
the values from the previous structure.</p>
<p>When converting from the old structure to the new one, <code class="docutils literal"><span class="pre">missing</span></code> will contain
<code class="docutils literal"><span class="pre">a</span></code> and its corresponding type because this is a field that does not exist and
must be created. The handler must fill-in <code class="docutils literal"><span class="pre">fields</span></code> with <code class="docutils literal"><span class="pre">a</span></code> and give it a
value. <code class="docutils literal"><span class="pre">droppedFields</span></code> will be empty because all fields in the old structure
are present in the new one.</p>
<p>When converting from the new structure to the old one, <code class="docutils literal"><span class="pre">droppedFields</span></code> will
contain <code class="docutils literal"><span class="pre">a</span></code> with a value and the handler must only accept the field to be
dropped or not. <code class="docutils literal"><span class="pre">missing</span></code> will be empty because all the fields in the old
structure are present in the new one.</p>
<p>There is a different handler for each one of these two conversions. In each
case, the handler must return true or false if the conversion succeeded or not.
If the handler returns false, it must not modify the <code class="docutils literal"><span class="pre">fields</span></code> argument.</p>
<p>In our example, we want to initialize <code class="docutils literal"><span class="pre">a</span></code> to 255 and accept to drop it only when
its value is 255. Here is how we must implement our handlers:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// from new Color to old Color</span>
<span class="kt">bool</span> <span class="nf">colorTo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="o">::</span><span class="n">qi</span><span class="o">::</span><span class="n">AnyValue</span><span class="o">&gt;&amp;</span> <span class="n">fields</span><span class="p">,</span>
             <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">qi</span><span class="o">::</span><span class="n">TypeInterface</span><span class="o">*&gt;&gt;&amp;</span> <span class="n">missing</span><span class="p">,</span>
             <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="o">::</span><span class="n">qi</span><span class="o">::</span><span class="n">AnyReference</span><span class="o">&gt;&amp;</span> <span class="n">droppedFields</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// if there are fields in the target structure that we don&#39;t have, we</span>
  <span class="c1">// can&#39;t convert</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">missing</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="c1">// we don&#39;t accept dropping any other field than &quot;a&quot;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">droppedFields</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">droppedFields</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">first</span> <span class="o">!=</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

  <span class="n">try</span>
  <span class="p">{</span>
    <span class="c1">// and then, we drop &quot;a&quot; only if its value is 255</span>
    <span class="k">return</span> <span class="n">droppedFields</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">toInt</span><span class="p">()</span> <span class="o">==</span> <span class="mi">255</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">catch</span> <span class="p">(...)</span>
  <span class="p">{</span>
    <span class="c1">// &quot;a&quot; was not an int, something went terribly wrong</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// from old Color to new Color</span>
<span class="kt">bool</span> <span class="nf">colorFrom</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="o">::</span><span class="n">qi</span><span class="o">::</span><span class="n">AnyValue</span><span class="o">&gt;&amp;</span> <span class="n">fields</span><span class="p">,</span>
               <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">qi</span><span class="o">::</span><span class="n">TypeInterface</span><span class="o">*&gt;&gt;&amp;</span> <span class="n">missing</span><span class="p">,</span>
               <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="o">::</span><span class="n">qi</span><span class="o">::</span><span class="n">AnyReference</span><span class="o">&gt;&amp;</span> <span class="n">droppedFields</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// we don&#39;t accept any field to be dropped</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">droppedFields</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="c1">// there can be only one missing field from the old Color, which is &quot;a&quot;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">missing</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">missing</span><span class="p">.</span><span class="n">front</span><span class="p">())</span> <span class="o">!=</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
  <span class="c1">// fill that field with our default value</span>
  <span class="n">fields</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qi</span><span class="o">::</span><span class="n">AnyValue</span><span class="o">::</span><span class="n">from</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is now possible to register the structure with these two handlers:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">QI_TYPE_STRUCT_EXTENSION_CONVERT_HANDLERS</span><span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="n">colorFrom</span><span class="p">,</span> <span class="n">colorTo</span><span class="p">);</span>
<span class="n">QI_TYPE_STRUCT_REGISTER</span><span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
</pre></div>
</div>
<p>Anytime a conversion from an old Color to a new Color is attempted, the
convertFrom handler will be called and when converting from a new Color to an
old Color, the colorTo handler will be called.</p>
</div>
</div>
</div>
<div class="section" id="enums">
<h2>Enums<a class="headerlink" href="#enums" title="Permalink to this headline">¶</a></h2>
<p>Enums are easy to register:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// color.hpp</span>

<span class="k">namespace</span> <span class="n">Graph</span> <span class="p">{</span>
  <span class="k">enum</span> <span class="n">Color</span> <span class="p">{</span>
    <span class="n">Red</span><span class="p">,</span>
    <span class="n">Green</span><span class="p">,</span>
    <span class="n">Blue</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// call this outside of any namespace</span>
<span class="n">QI_TYPE_ENUM_REGISTER</span><span class="p">(</span><span class="n">Graph</span><span class="o">::</span><span class="n">Color</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="classes">
<span id="guide-cxx-register-classes"></span><h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-registration-helper">
<h3>Using registration helper<a class="headerlink" href="#using-registration-helper" title="Permalink to this headline">¶</a></h3>
<p>Classes can only be registered in .cpp files:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// drawer.hpp</span>

<span class="k">namespace</span> <span class="n">Graph</span> <span class="p">{</span>
  <span class="k">class</span> <span class="nc">Drawer</span> <span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
      <span class="kt">bool</span> <span class="n">draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">p</span><span class="p">,</span> <span class="n">Color</span> <span class="n">color</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Drawing point&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="n">drawDone</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">qi</span><span class="o">::</span><span class="n">Signal</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">drawDone</span><span class="p">;</span>

      <span class="n">qi</span><span class="o">::</span><span class="n">Property</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">origin</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// drawer.cpp</span>

<span class="k">namespace</span> <span class="n">Graph</span> <span class="p">{</span>
  <span class="c1">// call this from inside the namespace of the class</span>
  <span class="n">QI_REGISTER_OBJECT</span><span class="p">(</span><span class="n">Drawer</span><span class="p">,</span> <span class="n">draw</span><span class="p">,</span> <span class="n">drawDone</span><span class="p">,</span> <span class="n">origin</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>There are two threading models for classes. <cite>Drawer</cite> is registered as
single threaded in the above example. When doing multiple calls of its
methods in parallel, they will be sequenced. If you need your object to support
multithreaded calls, use the MT macro:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// drawer.cpp</span>

<span class="k">namespace</span> <span class="n">Graph</span> <span class="p">{</span>
  <span class="c1">// call this from inside the namespace of the class</span>
  <span class="n">QI_REGISTER_MT_OBJECT</span><span class="p">(</span><span class="n">Drawer</span><span class="p">,</span> <span class="n">draw</span><span class="p">,</span> <span class="n">drawDone</span><span class="p">,</span> <span class="n">origin</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="doing-it-manually">
<span id="guide-cxx-register-types-object-manual"></span><h3>Doing it manually<a class="headerlink" href="#doing-it-manually" title="Permalink to this headline">¶</a></h3>
<p>The helper won&#8217;t always allow you to register a class, for example when you
have method overloading in your class. In these cases, you need to register
your type manually with <cite>qi::ObjectTypeBuilder</cite> so that you can specify the
signature of the function.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="c1">// drawer.hpp</span>

<span class="k">namespace</span> <span class="n">Graph</span> <span class="p">{</span>
  <span class="k">class</span> <span class="nc">Drawer</span> <span class="p">{</span>
    <span class="k">public</span><span class="o">:</span>
      <span class="kt">bool</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Initializing drawer&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">p</span><span class="p">,</span> <span class="n">Color</span> <span class="n">color</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Drawing point with color&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;Drawing point&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="n">qi</span><span class="o">::</span><span class="n">Signal</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">objectDrawn</span><span class="p">;</span>
      <span class="n">qi</span><span class="o">::</span><span class="n">Property</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">objectCount</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="c1">// drawer.cpp</span>

<span class="k">namespace</span> <span class="n">Graph</span> <span class="p">{</span>
  <span class="c1">// this won&#39;t work because we can&#39;t differentiate the two draw methods</span>
  <span class="c1">//QI_REGISTER_OBJECT(Drawer, draw, draw);</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="n">Graph</span> <span class="p">{</span>
  <span class="k">static</span> <span class="kt">bool</span> <span class="n">_qiregisterDrawer</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">::</span><span class="n">qi</span><span class="o">::</span><span class="n">ObjectTypeBuilder</span><span class="o">&lt;</span><span class="n">Drawer</span><span class="o">&gt;</span> <span class="n">builder</span><span class="p">;</span>
    <span class="c1">// use static_cast to remove ambiguity between overloads</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">advertiseMethod</span><span class="p">(</span><span class="s">&quot;draw&quot;</span><span class="p">,</span>
        <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="n">Drawer</span><span class="o">::*</span><span class="p">)(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">Color</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Drawer</span><span class="o">::</span><span class="n">draw</span><span class="p">));</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">advertiseMethod</span><span class="p">(</span><span class="s">&quot;draw&quot;</span><span class="p">,</span>
        <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="n">Drawer</span><span class="o">::*</span><span class="p">)(</span><span class="k">const</span> <span class="n">Point</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Drawer</span><span class="o">::</span><span class="n">draw</span><span class="p">));</span>
    <span class="c1">// no need to static_cast if there is no overload</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">advertiseMethod</span><span class="p">(</span><span class="s">&quot;init&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Drawer</span><span class="o">::</span><span class="n">init</span><span class="p">);</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">advertiseSignal</span><span class="p">(</span><span class="s">&quot;objectDrawn&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Drawer</span><span class="o">::</span><span class="n">objectDrawn</span><span class="p">);</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">advertiseProperty</span><span class="p">(</span><span class="s">&quot;objectCount&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Drawer</span><span class="o">::</span><span class="n">objectCount</span><span class="p">);</span>
    <span class="n">builder</span><span class="p">.</span><span class="n">registerType</span><span class="p">();</span>
    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">static</span> <span class="kt">bool</span> <span class="n">__qi_registrationDrawer</span> <span class="o">=</span> <span class="n">_qiregisterDrawer</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="more-on-threading-model">
<h3>More on Threading Model<a class="headerlink" href="#more-on-threading-model" title="Permalink to this headline">¶</a></h3>
<p>If you need your object to be multithreaded, set it on your builder:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">builder</span><span class="p">.</span><span class="n">setThreadingModel</span><span class="p">(</span><span class="n">qi</span><span class="o">::</span><span class="n">ObjectThreadingModel_MultiThread</span><span class="p">);</span>
</pre></div>
</div>
<p>It is also possible to have a single-threaded class on which only some methods
are multithreaded:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">builder</span><span class="p">.</span><span class="n">advertiseMethod</span><span class="p">(</span><span class="s">&quot;multiThreadedMethod&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Drawer</span><span class="o">::</span><span class="n">multiThreadedMethod</span><span class="p">,</span>
    <span class="n">qi</span><span class="o">::</span><span class="n">MetaCallType_Queued</span><span class="p">);</span>
</pre></div>
</div>
<p>If you also want non-type-erased calls to be single-threaded (on async,
signals, etc), you must inherit from <cite>Actor</cite>. See <a class="reference internal" href="../api/cpp/base/actor.html#api-actor"><span>qi::Actor and qi::Strand</span></a>.</p>
</div>
</div>
<div class="section" id="warning-about-registration-order">
<h2>Warning about registration order<a class="headerlink" href="#warning-about-registration-order" title="Permalink to this headline">¶</a></h2>
<p>It is important to know that all <code class="docutils literal"><span class="pre">_REGISTER_</span></code> macros depend on static
initialization (as you can see in <a class="reference internal" href="#guide-cxx-register-types-object-manual"><span>Doing it manually</span></a>)
and they are thus vulnerable to the <a class="reference external" href="https://isocpp.org/wiki/faq/ctors#static-init-order">static initialization order fiasco</a>.</p>
<p>If you have types that depend on each other, like a structure that contains a
structure or a class that has a function that returns a structure, you must
register them in the same file. Note that only macros containing <code class="docutils literal"><span class="pre">_REGISTER_</span></code>
in their name are vulnerable to that.</p>
<p>The common practice is to create a file named <code class="docutils literal"><span class="pre">registration.cpp</span></code> that contains
all these macros in correct order. Cyclic dependency is not supported.</p>
</div>
</div>


              </div>
            </div>
          </div>
          
            
              <div class="yui-b" id="sidebar">
                
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contents.html">Site map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../news/index.html">What’s new</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index_dev_guide.html">NAOqi - Developer guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/creating_applications/index.html">Creating an application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ref/life/index.html">Programming for a living robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index_tuto.html">Other tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../software/choregraphe/index.html">Choregraphe Suite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../programming_index.html">SDKs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../naoqi/index.html">NAOqi APIs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">qi Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../api/index.html">API References</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Hands-on Guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="cxx-client.html">C++ - How to write a qimessaging client</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-service.html">C++ - How to write a qimessaging service</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">Registering types in the type system</a><ul class="simple">
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="cxx-async.html">Asynchronous operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-log.html">Using qi::log</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-log-client.html">How to receive and send logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-linguist.html">Internationalization Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-path.html">Handling Paths Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-qilang.html">Using qilang to generate strongly-typed proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="py-client.html">Python - How to write a qimessaging client</a></li>
<li class="toctree-l4"><a class="reference internal" href="py-service.html">Python - How to write a qimessaging service</a></li>
<li class="toctree-l4"><a class="reference internal" href="py-log-client.html">Python - How to receive and send logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="py-tonaoqi2.html">How to switch from NAOqi to qi Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="qi-app-arguments.html">qi application arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="qicli.html">Using qicli commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="qilaunch.html">Using qilaunch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/index.html">Design Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/typesystem.html">Type system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/object.html">Object type erasure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/template.html">Registering template types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/call.html">Call code path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/messaging.html">Messaging system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog/index.html">qi Framework - ChangeLog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog/interface.html">qi Framework - Deprecation history</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ref/index.html">Former NAOqi Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../simulators/simulator_index.html">Simulators</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../home_nao.html"><strong>NAO</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../home_pepper.html"><strong>Pepper</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../home_romeo.html"><strong>Romeo</strong> - Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../legal/notice.html">Legal notices</a></li>
</ul>

    <div id="on-this-page" style="display:none;">
        <h2 id="otp-link">On this page</h2>
        <div id="toc-list">
            <ul>
<li><a class="reference internal" href="#">Registering types in the type system</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#structures">Structures</a><ul>
<li><a class="reference internal" href="#using-pimpl-in-structures">Using PIMPL in structures</a></li>
<li><a class="reference internal" href="#struct-extension">Struct extension</a><ul>
<li><a class="reference internal" href="#adding-or-dropping-fields-automatically">Adding or dropping fields automatically</a></li>
<li><a class="reference internal" href="#adding-or-dropping-fields-manually">Adding or dropping fields manually</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#enums">Enums</a></li>
<li><a class="reference internal" href="#classes">Classes</a><ul>
<li><a class="reference internal" href="#using-registration-helper">Using registration helper</a></li>
<li><a class="reference internal" href="#doing-it-manually">Doing it manually</a></li>
<li><a class="reference internal" href="#more-on-threading-model">More on Threading Model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#warning-about-registration-order">Warning about registration order</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
        </div>
      </div>
              </div>
            
          
        </div>
    </main>
    <a href="#0" class="cd-top"></a>
    <div id="ft">
      
      <a title="Glossary" href="../../../glossary.html">Glossary</a>
      <a title="Site map" href="../../../contents.html">Site map</a>
      <a title="Index" href="../../../genindex.html">Index</a>
      <a title="Support" target="_blank" href="https://account.aldebaran.com/support/">Support</a>
      <a title="Contact" target="_blank" href="https://www.aldebaran.com/en/contact">Contact</a>
      <a title="Legal Notices" href="../../../legal/notice.html">Legal Notices</a>
      
      
      <img src="https://www.ald.softbankrobotics.com/sites/aldebaran/files/logos-picture/2016_digital_logo_sbr_112x31_0.png" alt="">
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>