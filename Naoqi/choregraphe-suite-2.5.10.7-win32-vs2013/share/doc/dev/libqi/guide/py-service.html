<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python - How to write a qimessaging service &mdash; Aldebaran 2.5.9.8-r3 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.5.9.8-r3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Aldebaran 2.5.9.8-r3 documentation" href="../../../index.html" />
    <link rel="up" title="Hands-on Guide" href="index.html" />
    <link rel="next" title="Python - How to receive and send logs" href="py-log-client.html" />
    <link rel="prev" title="Python - How to write a qimessaging client" href="py-client.html" />
 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115894784-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115894784-1');
</script>

<script type="text/javascript" src="https://cloud.aldebaran-robotics.com/static/js/topbar.js"></script>
<style>
div#hd::after {
  
  
  content: 'NAOqi 2.5';
  
  
  
  position: absolute;
  margin-top: -54px;
  right: -4px;
  font-size: 125%;
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
  -o-transform: rotate(45deg);
  transform: rotate(45deg);
  }
</style>
<script>

$(window).ready(function () {

    //Aldebaran Top bar
     var barLinks = [];
     barLinks.push({'name':'Aldebaran Site', 'url':'http://www.aldebaran-robotics.com', 'click':'', 'img':'https://cloud.aldebaran-robotics.com/static/img/aldeb.png'});
     barLinks.push({'name':'Documentation', 'url':'../../../index.html', 'click':"", 'img':''});
     function ShowBar(name, email, usertype) {
        var barParams = {
            'name'    : name,
            'email'   : email,
            'usertype': usertype,
            'loginfct': "FctLogin"
        }
        try { InitTopBar(barParams, barLinks); } catch (e) { console.log('Top Bar Init Failed'); }
    }
    ShowBar();

    var width_label = 0;
    $('dl.function-index dt > span').each(function () {
        $(this).css('width', 'auto');
        width_label = Math.max(width_label, $(this).width());
    }).width(width_label + 30);
    $('.sig-paren').width('auto');

    // first level navigation

    var buttonIds = [".naoqi", "pepper", "nao", "romeo"];
    for(id in buttonIds){
        $(id).removeClass("active");
    }
    //Aldebaran project
    if ($('.toctree-l1.current a').text().indexOf("Romeo ")==0){
        $(".romeo").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Pepper ")==0){
        $(".pepper").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("NAO ")==0){
        $(".nao").toggleClass('active');
    }
    else if($('.toctree-l1.current a').text().indexOf("NAOqi ")==0){
        $(".naoqi").toggleClass('active');
    }

    //qibuild project
    if ($('.toctree-l1.current a').text().indexOf("Welcome to qiBuild documentation !")==0){
        $(".beginner").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Advanced qibuild usage")==0){
        $(".advanced").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Hacking qiBuild")==0){
        $(".hacking").toggleClass('active');
    }

    // add "On this page", add cssClasses
    if($('.yui-g .section h1').length > 0){
        $('.yui-g .section h1:first').addClass("titleWrapper");
        $('.yui-g .section h1:first').after($("#on-this-page").html())
    }
    else if($('.yui-g .section h2').length > 0){
        $('.yui-g .section h2:first').addClass("titleWrapper");
        $('.yui-g .section h2:first').after($("#on-this-page").html())
    }
    //remove first element on this page
    if($("#on-this-page").length > 0){
        var doms = $(".yui-g .section :first").nextUntil("#toc-list");
        doms = doms.add($("#toc-list"));
        doms.wrapAll('<div class="iNavWrapper"></div>');
        $("#toc-list ul li a:first").remove()
        $("#toc-list ul:first").replaceWith($("#toc-list ul li").html())
    }
    $("#toc-list").hide();
    $("#otp-link").click(function(){
        $("#toc-list").slideToggle();
        if($("h2#otp-link").hasClass("change-before")){
            $("h2#otp-link").removeClass("change-before")
        }
        else{
            $("h2#otp-link").addClass("change-before")
        }
    });

    if($("a.current.reference.internal").length>0){
        var left = $("a.current.reference.internal").position().left-1;
        var width = $("a.current.reference.internal").width();
        var offset = 51;
        var sidebarWidth = 339;
        var right = sidebarWidth - (left + width + offset);
        if($("a.current.reference.internal").height() <= 15){
            $("a.current.reference.internal").css("white-space","nowrap");
            $("a.current.reference.internal").css({"backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        else{
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
            left = $("a.current.reference.internal").position().left-1;
            width = $("a.current.reference.internal").width();
            right = sidebarWidth - (left + width + offset);
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        $("a.current.reference.internal").parent().css("list-style-type","none");
    }

    //back to top
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700;
    //grab the "back to top" link
    var back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
        //back to top button
        ( $(this).scrollTop() > offset ) ? back_to_top.addClass('cd-is-visible') : back_to_top.removeClass('cd-is-visible cd-fade-out');
        if( $(this).scrollTop() > offset_opacity ) {
            back_to_top.addClass('cd-fade-out');
        }
    });

    //smooth scroll to top
    back_to_top.click(function(event){
        event.preventDefault();
        $('body,html').animate({
            scrollTop: 0 ,
        }, scroll_top_duration
        );
    });
    //add show source button

    //replace "go" with "search"
    $("#searchbox form input[type=submit]").val("Search")

    //trigger click on version triangle to jump to whats new
    $("#hd").click(function(e){if(e.pageX >= this.offsetWidth && e.pageY<120){$(".whatsnew")[0].click()}})
})

</script>


  </head>
  <body role="document">

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      
      <h1><a href="../../../index.html">SoftBank Robotics documentation</a>
      
      
      <span><a class="whatsnew" href="../../../news/index.html" >
      
          What's new in NAOqi 2.5?
      
      </a></span>
      
      </h1>
      <div id="global-nav">
        
        <a class="naoqi" title="NAOqi Developer guide" href="../../../index_dev_guide.html">NAOqi</a>
        <a class="pepper" title="Pepper documentation" href="../../../home_pepper.html">Pepper</a>
        <a class="nao" title="NAO documentation" href="../../../home_nao.html">NAO</a>
        <a class="romeo" title="Romeo Documentation" href="../../../home_romeo.html">Romeo</a>
        
        
        
        <div class="nav">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script></div>
      </div>

    </div>
    <main class="cd-container">
        <div id="bd">
          <div id="yui-main">
            <div class="yui-b">
              <div class="yui-g" id="dev-libqi-guide-py-service">
                
  <div class="section" id="python-how-to-write-a-qimessaging-service">
<span id="guide-py-service"></span><h1>Python - How to write a qimessaging service<a class="headerlink" href="#python-how-to-write-a-qimessaging-service" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">Â¶</a></h2>
<p>This guide will show you how to write a qimessaging service in Python, and advertise
it to others.</p>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">Â¶</a></h3>
<ul class="simple">
<li>An installed python NAOqi SDK for your operating system.</li>
</ul>
</div>
<div class="section" id="creating-a-service">
<h3>Creating a service<a class="headerlink" href="#creating-a-service" title="Permalink to this headline">Â¶</a></h3>
<p>We are going to create simple service that raises a signal when its method bang is called.</p>
<p>To do that, let&#8217;s declare a simple class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qi</span>

<span class="k">class</span> <span class="nc">MyFooService</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c">#define a signal &#39;onBang&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">onBang</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>

  <span class="c">#define a bang method that will trigger the onBang signal</span>
  <span class="k">def</span> <span class="nf">bang</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c">#trigger the signal with 42 as value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">onBang</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-session">
<h3>Creating a session<a class="headerlink" href="#creating-a-session" title="Permalink to this headline">Â¶</a></h3>
<p>To make the service available to others we need a <a class="reference internal" href="../api/python/session.html#qi.Session" title="qi.Session"><code class="xref py py-class docutils literal"><span class="pre">qi.Session</span></code></a>.</p>
<p>We will use the session of the <a class="reference internal" href="../api/python/application.html#qi.Application" title="qi.Application"><code class="xref py py-class docutils literal"><span class="pre">qi.Application</span></code></a> that is already connected to a ServiceDirectory,
and register our MyFooService created just above under the name &#8216;foo&#8217;.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qi</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c">#create an application</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c">#create an instance of MyFooService</span>
<span class="n">myfoo</span> <span class="o">=</span> <span class="n">MyFooService</span><span class="p">()</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">session</span>
<span class="c">#let&#39;s register our service with the name &quot;foo&quot;</span>
<span class="nb">id</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">registerService</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">myfoo</span><span class="p">)</span>

<span class="c">#let the application run</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="test-the-service">
<h3>Test the service<a class="headerlink" href="#test-the-service" title="Permalink to this headline">Â¶</a></h3>
<p>We are going to create a simple client to call the service and react to it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qi</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">onBangCb</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
  <span class="k">print</span> <span class="s">&quot;bang:&quot;</span><span class="p">,</span> <span class="n">i</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">session</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>

<span class="c">#register a callback on &#39;onBang&#39;</span>
<span class="n">foo</span><span class="o">.</span><span class="n">onBang</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">onBangCb</span><span class="p">)</span>
<span class="c">#call bang</span>
<span class="n">foo</span><span class="o">.</span><span class="n">bang</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="wrapping-asynchronous-api">
<h3>Wrapping Asynchronous API<a class="headerlink" href="#wrapping-asynchronous-api" title="Permalink to this headline">Â¶</a></h3>
<p>If the API you are wrapping is asynchronous, you want to avoid blocking in your function just waiting for your asynchronous call to finish.</p>
<p>To avoid blocking your function you can use <a class="reference internal" href="../api/python/future.html#qi.Promise" title="qi.Promise"><code class="xref py py-class docutils literal"><span class="pre">qi.Promise</span></code></a> and <a class="reference internal" href="../api/python/future.html#qi.Future" title="qi.Future"><code class="xref py py-class docutils literal"><span class="pre">qi.Future</span></code></a>.</p>
<p>The procedure is the following:</p>
<ul class="simple">
<li>You create a <a class="reference internal" href="../api/python/future.html#qi.Promise" title="qi.Promise"><code class="xref py py-class docutils literal"><span class="pre">qi.Promise</span></code></a></li>
<li>You create a handler that will set the value of the <a class="reference internal" href="../api/python/future.html#qi.Promise" title="qi.Promise"><code class="xref py py-class docutils literal"><span class="pre">qi.Promise</span></code></a> when the asynchronous call finish</li>
<li>You launch your asynchronous call giving it the handler, that will be called on completion</li>
<li>You return the <a class="reference internal" href="../api/python/future.html#qi.Future" title="qi.Future"><code class="xref py py-class docutils literal"><span class="pre">qi.Future</span></code></a> to your user</li>
</ul>
<p>For the example we will implement a mycrazydelay and mycrazydelay_async.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># stupid implementation of a function that:</span>
<span class="c">#   - take time</span>
<span class="c">#   - call finish_callback</span>
<span class="c">#   - return the delay (or the result of the computation)</span>
<span class="c"># if this function was strictly used synchronously the callback you be useless</span>
<span class="k">def</span> <span class="nf">mycrazydelay</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">finish_callback</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">finish_callback</span><span class="p">:</span>
       <span class="n">finish_callback</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">delay</span>

<span class="c"># simple wrapper around mycrazydelay to make it asynchronous</span>
<span class="k">def</span> <span class="nf">mycrazydelay_async</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">finish_callback</span><span class="p">):</span>
   <span class="n">qi</span><span class="o">.</span><span class="n">async</span><span class="p">(</span><span class="n">mycrazydelay</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">finish_callback</span><span class="p">))</span>
</pre></div>
</div>
<p>and create a Foo service that call this two methods:</p>
<blockquote>
<div><ul class="simple">
<li>bar which wrap the synchronous mycrazydelay</li>
<li>betterBar which wrap the asynchronous mycrazydelay_async</li>
</ul>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>

    <span class="c">#block a thread for 50sec :(</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mycrazydelay</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">betterBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Promise</span><span class="p">()</span>

        <span class="c"># callback that will set the value on the promise</span>
        <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
           <span class="n">p</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="c"># return immediately</span>
        <span class="n">mycrazydelay_async</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
        <span class="c"># return the future that will have the value set when p.setValue is called</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">future</span><span class="p">()</span>
</pre></div>
</div>
<p>The two functions bar and betterBar behave exactly the same from a client side of view.
The first one will block a thread for 50sec, the second one is asynchronous, and keeps precious thread resources free.
betterBar returns a Future, that will be notified when p.setValue is called.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>returning a Future does not change what the client will see. If you return a Future containing a bool, the client will just see a bool. Future are not sent thought the network.</p>
<p class="last">So if you want to use the API asynchronously you have to use qi.async.</p>
</div>
<p>Let&#8217;s look at a client example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">app</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">foo</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>

<span class="c">#both call are identical, they return a delay</span>
<span class="n">delay</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
<span class="n">delay</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">betterBar</span><span class="p">()</span>

<span class="c">#to use them asynchronously:</span>
<span class="n">fut</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">async</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">bar</span><span class="p">)</span>
<span class="n">fut</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">async</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">betterBar</span><span class="p">)</span>

<span class="n">delay</span> <span class="o">=</span> <span class="n">fut</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="single-threaded-multi-threaded-mode-for-services">
<h3>Single-threaded / Multi-threaded mode for services<a class="headerlink" href="#single-threaded-multi-threaded-mode-for-services" title="Permalink to this headline">Â¶</a></h3>
<p>By default, python services are in single-threaded mode.
This means their methods cannot be called in parallel.
You might encounter this kind of message if you call several methods of such a module at the same time.</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">[W] 1394221129.982971 4079 qitype.dynamicobject: Time-out acquiring object lock when calling method. Deadlock?</span>
<span class="go">[E] 1394221129.988775 4052 python: RuntimeError: Time-out acquiring lock. Deadlock?</span>
<span class="go">[W] 1394221137.850762 3859 qitype.dynamicobject: Time-out acquiring object lock when calling method. Deadlock?</span>
</pre></div>
</div>
<p>If you need to call methods of your module in parallel, you will need to protect them yourself,
and specify that your module is in multithread mode by using the qi.multiThreaded decorator.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@qi.multiThreaded</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
  <span class="c">#</span>
  <span class="c"># Define your service</span>
  <span class="c">#</span>
</pre></div>
</div>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          
            
              <div class="yui-b" id="sidebar">
                
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contents.html">Site map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../news/index.html">Whatâs new</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index_dev_guide.html">NAOqi - Developer guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/creating_applications/index.html">Creating an application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ref/life/index.html">Programming for a living robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index_tuto.html">Other tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../software/choregraphe/index.html">Choregraphe Suite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../programming_index.html">SDKs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../naoqi/index.html">NAOqi APIs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">qi Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../api/index.html">API References</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Hands-on Guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="cxx-client.html">C++ - How to write a qimessaging client</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-service.html">C++ - How to write a qimessaging service</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-register-types.html">Registering types in the type system</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-async.html">Asynchronous operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-log.html">Using qi::log</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-log-client.html">How to receive and send logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-linguist.html">Internationalization Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-path.html">Handling Paths Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="cxx-qilang.html">Using qilang to generate strongly-typed proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="py-client.html">Python - How to write a qimessaging client</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">Python - How to write a qimessaging service</a><ul class="simple">
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="py-log-client.html">Python - How to receive and send logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="py-tonaoqi2.html">How to switch from NAOqi to qi Framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="qi-app-arguments.html">qi application arguments</a></li>
<li class="toctree-l4"><a class="reference internal" href="qicli.html">Using qicli commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="qilaunch.html">Using qilaunch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/index.html">Design Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/typesystem.html">Type system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/object.html">Object type erasure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/template.html">Registering template types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/call.html">Call code path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/messaging.html">Messaging system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog/index.html">qi Framework - ChangeLog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog/interface.html">qi Framework - Deprecation history</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ref/index.html">Former NAOqi Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../simulators/simulator_index.html">Simulators</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../home_nao.html"><strong>NAO</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../home_pepper.html"><strong>Pepper</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../home_romeo.html"><strong>Romeo</strong> - Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../legal/notice.html">Legal notices</a></li>
</ul>

    <div id="on-this-page" style="display:none;">
        <h2 id="otp-link">On this page</h2>
        <div id="toc-list">
            <ul>
<li><a class="reference internal" href="#">Python - How to write a qimessaging service</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#creating-a-service">Creating a service</a></li>
<li><a class="reference internal" href="#creating-a-session">Creating a session</a></li>
<li><a class="reference internal" href="#test-the-service">Test the service</a></li>
<li><a class="reference internal" href="#wrapping-asynchronous-api">Wrapping Asynchronous API</a></li>
<li><a class="reference internal" href="#single-threaded-multi-threaded-mode-for-services">Single-threaded / Multi-threaded mode for services</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    </div>
        </div>
      </div>
              </div>
            
          
        </div>
    </main>
    <a href="#0" class="cd-top"></a>
    <div id="ft">
      
      <a title="Glossary" href="../../../glossary.html">Glossary</a>
      <a title="Site map" href="../../../contents.html">Site map</a>
      <a title="Index" href="../../../genindex.html">Index</a>
      <a title="Support" target="_blank" href="https://account.aldebaran.com/support/">Support</a>
      <a title="Contact" target="_blank" href="https://www.aldebaran.com/en/contact">Contact</a>
      <a title="Legal Notices" href="../../../legal/notice.html">Legal Notices</a>
      
      
      <img src="https://www.ald.softbankrobotics.com/sites/aldebaran/files/logos-picture/2016_digital_logo_sbr_112x31_0.png" alt="">
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>