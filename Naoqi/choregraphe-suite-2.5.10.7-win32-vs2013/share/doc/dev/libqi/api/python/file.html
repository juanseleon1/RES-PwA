<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>qicore.File &mdash; Aldebaran 2.5.9.8-r3 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '2.5.9.8-r3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Aldebaran 2.5.9.8-r3 documentation" href="../../../../index.html" />
    <link rel="up" title="Python qi API reference" href="index.html" />
    <link rel="next" title="Type equivalences between languages" href="../transtyping.html" />
    <link rel="prev" title="qi.Module API" href="module.html" />
 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115894784-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115894784-1');
</script>

<script type="text/javascript" src="https://cloud.aldebaran-robotics.com/static/js/topbar.js"></script>
<style>
div#hd::after {
  
  
  content: 'NAOqi 2.5';
  
  
  
  position: absolute;
  margin-top: -54px;
  right: -4px;
  font-size: 125%;
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
  -o-transform: rotate(45deg);
  transform: rotate(45deg);
  }
</style>
<script>

$(window).ready(function () {

    //Aldebaran Top bar
     var barLinks = [];
     barLinks.push({'name':'Aldebaran Site', 'url':'http://www.aldebaran-robotics.com', 'click':'', 'img':'https://cloud.aldebaran-robotics.com/static/img/aldeb.png'});
     barLinks.push({'name':'Documentation', 'url':'../../../../index.html', 'click':"", 'img':''});
     function ShowBar(name, email, usertype) {
        var barParams = {
            'name'    : name,
            'email'   : email,
            'usertype': usertype,
            'loginfct': "FctLogin"
        }
        try { InitTopBar(barParams, barLinks); } catch (e) { console.log('Top Bar Init Failed'); }
    }
    ShowBar();

    var width_label = 0;
    $('dl.function-index dt > span').each(function () {
        $(this).css('width', 'auto');
        width_label = Math.max(width_label, $(this).width());
    }).width(width_label + 30);
    $('.sig-paren').width('auto');

    // first level navigation

    var buttonIds = [".naoqi", "pepper", "nao", "romeo"];
    for(id in buttonIds){
        $(id).removeClass("active");
    }
    //Aldebaran project
    if ($('.toctree-l1.current a').text().indexOf("Romeo ")==0){
        $(".romeo").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Pepper ")==0){
        $(".pepper").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("NAO ")==0){
        $(".nao").toggleClass('active');
    }
    else if($('.toctree-l1.current a').text().indexOf("NAOqi ")==0){
        $(".naoqi").toggleClass('active');
    }

    //qibuild project
    if ($('.toctree-l1.current a').text().indexOf("Welcome to qiBuild documentation !")==0){
        $(".beginner").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Advanced qibuild usage")==0){
        $(".advanced").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Hacking qiBuild")==0){
        $(".hacking").toggleClass('active');
    }

    // add "On this page", add cssClasses
    if($('.yui-g .section h1').length > 0){
        $('.yui-g .section h1:first').addClass("titleWrapper");
        $('.yui-g .section h1:first').after($("#on-this-page").html())
    }
    else if($('.yui-g .section h2').length > 0){
        $('.yui-g .section h2:first').addClass("titleWrapper");
        $('.yui-g .section h2:first').after($("#on-this-page").html())
    }
    //remove first element on this page
    if($("#on-this-page").length > 0){
        var doms = $(".yui-g .section :first").nextUntil("#toc-list");
        doms = doms.add($("#toc-list"));
        doms.wrapAll('<div class="iNavWrapper"></div>');
        $("#toc-list ul li a:first").remove()
        $("#toc-list ul:first").replaceWith($("#toc-list ul li").html())
    }
    $("#toc-list").hide();
    $("#otp-link").click(function(){
        $("#toc-list").slideToggle();
        if($("h2#otp-link").hasClass("change-before")){
            $("h2#otp-link").removeClass("change-before")
        }
        else{
            $("h2#otp-link").addClass("change-before")
        }
    });

    if($("a.current.reference.internal").length>0){
        var left = $("a.current.reference.internal").position().left-1;
        var width = $("a.current.reference.internal").width();
        var offset = 51;
        var sidebarWidth = 339;
        var right = sidebarWidth - (left + width + offset);
        if($("a.current.reference.internal").height() <= 15){
            $("a.current.reference.internal").css("white-space","nowrap");
            $("a.current.reference.internal").css({"backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        else{
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
            left = $("a.current.reference.internal").position().left-1;
            width = $("a.current.reference.internal").width();
            right = sidebarWidth - (left + width + offset);
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        $("a.current.reference.internal").parent().css("list-style-type","none");
    }

    //back to top
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700;
    //grab the "back to top" link
    var back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
        //back to top button
        ( $(this).scrollTop() > offset ) ? back_to_top.addClass('cd-is-visible') : back_to_top.removeClass('cd-is-visible cd-fade-out');
        if( $(this).scrollTop() > offset_opacity ) {
            back_to_top.addClass('cd-fade-out');
        }
    });

    //smooth scroll to top
    back_to_top.click(function(event){
        event.preventDefault();
        $('body,html').animate({
            scrollTop: 0 ,
        }, scroll_top_duration
        );
    });
    //add show source button

    //replace "go" with "search"
    $("#searchbox form input[type=submit]").val("Search")

    //trigger click on version triangle to jump to whats new
    $("#hd").click(function(e){if(e.pageX >= this.offsetWidth && e.pageY<120){$(".whatsnew")[0].click()}})
})

</script>


  </head>
  <body role="document">

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      
      <h1><a href="../../../../index.html">SoftBank Robotics documentation</a>
      
      
      <span><a class="whatsnew" href="../../../../news/index.html" >
      
          What's new in NAOqi 2.5?
      
      </a></span>
      
      </h1>
      <div id="global-nav">
        
        <a class="naoqi" title="NAOqi Developer guide" href="../../../../index_dev_guide.html">NAOqi</a>
        <a class="pepper" title="Pepper documentation" href="../../../../home_pepper.html">Pepper</a>
        <a class="nao" title="NAO documentation" href="../../../../home_nao.html">NAO</a>
        <a class="romeo" title="Romeo Documentation" href="../../../../home_romeo.html">Romeo</a>
        
        
        
        <div class="nav">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script></div>
      </div>

    </div>
    <main class="cd-container">
        <div id="bd">
          <div id="yui-main">
            <div class="yui-b">
              <div class="yui-g" id="dev-libqi-api-python-file">
                
  <div class="section" id="qicore-file">
<h1>qicore.File<a class="headerlink" href="#qicore-file" title="Permalink to this headline">¶</a></h1>
<p id="api-py-file-import">Import:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qi</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>       <span class="c"># qi.Application must be instantiated first</span>
<span class="n">qicore</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="s">&quot;qicore&quot;</span><span class="p">)</span> <span class="c"># Load and import the qicore module</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="module.html#api-py-module"><span>qi.Module API</span></a> and <a class="reference internal" href="application.html#api-py-application"><span>qi.Application API</span></a> documentation for more details
about importing modules.</p>
<p><em>Note: In the following code examples, this previous import code sample is assumed to prefix the
example code. For a complete working example, see</em> <a class="reference internal" href="../cpp/file.html#api-file-complete-example"><span>Complete example : Alice&#8217;s Image Store Service</span></a>.</p>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a> provides a way to open a file in read-only mode on the local file system
and share the content of this file with potentially remote services.</p>
<p>We provide algorithms to copy a remote file&#8217;s content to make a local copy of it,
using the <a class="reference internal" href="../cpp/file.html#qi::copyToLocal__FilePtr.Path" title="qi::copyToLocal"><code class="xref cpp cpp-guess docutils literal"><span class="pre">copyToLocal</span></code></a> function or <a class="reference internal" href="../cpp/file.html#qi::FileCopyToLocal" title="qi::FileCopyToLocal"><code class="xref cpp cpp-guess docutils literal"><span class="pre">FileCopyToLocal</span></code></a> type.</p>
</div>
<div class="section" id="reference">
<h2>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference internal" href="../cpp/file.html#api-file"><span>qi::File C++ API</span></a> for complete API reference.</p>
</div>
<div class="section" id="detailed-usage-description">
<span id="api-py-file-usage"></span><h2>Detailed Usage Description<a class="headerlink" href="#detailed-usage-description" title="Permalink to this headline">¶</a></h2>
<p>The following examples are partial for clarity.
For a <strong>complete working example</strong>, see section <a class="reference internal" href="../cpp/file.html#api-file-complete-example"><span>Complete example : Alice&#8217;s Image Store Service</span></a>.</p>
<div class="section" id="opening-a-file-in-read-only-mode-for-sharing-access">
<h3>Opening a file in read-only mode for sharing access<a class="headerlink" href="#opening-a-file-in-read-only-mode-for-sharing-access" title="Permalink to this headline">¶</a></h3>
<p>Once <a class="reference internal" href="#api-py-file-import"><span>qicore module is loaded</span></a>, use <a class="reference internal" href="../cpp/file.html#qi::openLocalFile__qi::PathCR" title="qi::openLocalFile"><code class="xref cpp cpp-guess docutils literal"><span class="pre">openLocalFile</span></code></a>
to open the file in sharing read-only mode:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">file</span> <span class="o">=</span> <span class="n">qicore</span><span class="o">.</span><span class="n">openLocalFile</span><span class="p">(</span><span class="s">&quot;valid/path/to/file.ext&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, the <code class="xref cpp cpp-guess docutils literal"><span class="pre">file</span></code> object can be passed to a service API requesting a <a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a>,
making the content of the file available to the service even if remote.</p>
<p>If the file does not exist, an exception will be thrown.</p>
</div>
<div class="section" id="file-access-lifetime">
<h3>File access lifetime<a class="headerlink" href="#file-access-lifetime" title="Permalink to this headline">¶</a></h3>
<p>The lifetime of the file access is extended by the shared ownership between all
the <a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a>, even if the instance is remote.</p>
<p>The <a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a> object is kept alive and the file access open by default until
all <a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a> objects referring owning it are destroyed.
The file access is automatically closed when <a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a> is destroyed.</p>
<p>Once you don&#8217;t need it anymore and want to explicitly stop owning the access,
you can stop referencing the file access.
The file access will be closed if there is no other owner still using it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">someServiceOperation</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span>
    <span class="c"># Do some work  with file...</span>

    <span class="c"># No need to work with the file anymore.</span>
    <span class="k">del</span> <span class="nb">file</span> <span class="c"># From now on, `file` is not usable anymore.</span>
    <span class="c"># If we were the only one accessing this file,</span>
    <span class="c"># access to it&#39;s content is now closed.</span>
</pre></div>
</div>
</div>
<div class="section" id="request-or-provide-read-only-access-to-the-content-of-a-file">
<h3>Request or provide read-only access to the content of a file<a class="headerlink" href="#request-or-provide-read-only-access-to-the-content-of-a-file" title="Permalink to this headline">¶</a></h3>
<p>A service can request read-only access to the content of a file by using
<a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a> as argument.</p>
<p>Similarly, a service can provide read-only access to a file by having
a function return a <a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a>.</p>
<p>For example (after <a class="reference internal" href="#api-py-file-import"><span>loading qicore module</span></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyService</span><span class="p">:</span>
    <span class="c">#...</span>

    <span class="c"># Store a copy of the provided file, associated with the provided name.</span>
    <span class="k">def</span> <span class="nf">storeFile</span><span class="p">(</span><span class="n">fileToStore</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c">#...</span>

    <span class="c"># Provide access to a stored file found by name.</span>
    <span class="k">def</span> <span class="nf">getFile</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="c">#...</span>

    <span class="c">#...</span>
</pre></div>
</div>
<p>(This is a partial example, see <a class="reference internal" href="../cpp/file.html#api-file-complete-example"><span>Complete example : Alice&#8217;s Image Store Service</span></a> for complete working examples.)</p>
<p>In this example, the user of the service can provide access to a file this way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">backup</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">pathFileToStore</span><span class="p">):</span>
    <span class="n">service</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&#39;MyService&#39;</span><span class="p">)</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="n">qicore</span><span class="o">.</span><span class="n">openLocalFile</span><span class="p">(</span><span class="n">pathFileToStore</span><span class="p">)</span>
    <span class="c"># Now we can share reading access to this file.</span>
    <span class="n">service</span><span class="o">.</span><span class="n">storeFile</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="c"># At this point, the service have a copy of the file and can start to work with it.</span>
</pre></div>
</div>
<p>and acquire access to a file content provided by the service this way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="n">name</span><span class="p">):</span> <span class="c"># service is a MyService instance</span>
    <span class="n">service</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&#39;MyService&#39;</span><span class="p">)</span>
    <span class="c"># Get Access to the file.</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">file</span><span class="p">:</span>
      <span class="c"># Then work with the file content.</span>
      <span class="c"># ...</span>
</pre></div>
</div>
</div>
<div class="section" id="make-a-local-copy-of-a-provided-file">
<h3>Make a local copy of a provided file<a class="headerlink" href="#make-a-local-copy-of-a-provided-file" title="Permalink to this headline">¶</a></h3>
<p>We can use the <a class="reference internal" href="../cpp/file.html#qi::copyToLocal__FilePtr.Path" title="qi::copyToLocal"><code class="xref cpp cpp-guess docutils literal"><span class="pre">copyToLocal</span></code></a> function to make a local copy of the file provided
through a <a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a>.
The <a class="reference internal" href="../cpp/file.html#qi::copyToLocal__FilePtr.Path" title="qi::copyToLocal"><code class="xref cpp cpp-guess docutils literal"><span class="pre">copyToLocal</span></code></a> function will transfer a copy of the content of the file to the
local file system, even if the original file is on a remote file system.</p>
<p>For example, if we want a service function to make a full copy of a provided file, in a
local temporary location, before doing any more work
(after <a class="reference internal" href="#api-py-file-import"><span>loading qicore module</span></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyService</span><span class="p">:</span>
    <span class="c">#...</span>

    <span class="k">def</span> <span class="nf">storeFile</span><span class="p">(</span><span class="n">fileToStore</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span> <span class="c"># fileToStore is a qicore.File instance</span>

        <span class="c"># First, make a local copy in a temporary files directory:</span>
        <span class="n">tempFilePath</span> <span class="o">=</span> <span class="n">generateTemporaryFilePath</span><span class="p">()</span>
        <span class="n">qicore</span><span class="o">.</span><span class="n">copyToLocal</span><span class="p">(</span><span class="n">fileToStore</span><span class="p">,</span> <span class="n">tempFilePath</span><span class="p">)</span> <span class="c"># This call wait for the end of the copy.</span>

        <span class="c"># We now have a local copy of the remote file,</span>
        <span class="c"># we don&#39;t need the remote access anymore.</span>
        <span class="n">fileToStore</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Now we can work with the local copy of the file:</span>
        <span class="n">storeFileInDatabase</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tempFilePath</span><span class="p">)</span>
</pre></div>
</div>
<p>In the same way, we can provide access to the data of the file by returning a <a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyService</span><span class="p">:</span>
    <span class="c">#...</span>

    <span class="k">def</span> <span class="nf">getFile</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>

        <span class="n">fileLocation</span> <span class="o">=</span> <span class="n">findFileLocation</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fileLocation</span><span class="p">):</span>
            <span class="c"># Now we can open it and provide it to the user for reading.</span>
            <span class="k">return</span> <span class="n">qicore</span><span class="o">.</span><span class="n">openLocalFile</span><span class="p">(</span><span class="n">fileLocation</span><span class="p">)</span>

        <span class="c"># We didn&#39;t find the file!</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
<p>Then the user can retrieve a copy of the file and work with it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">fileLocation</span><span class="p">):</span>

    <span class="c"># Get access to the file.</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">getFile</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">file</span><span class="p">:</span> <span class="c"># The file was found.</span>
        <span class="c"># We want to make a local copy before working on the file.</span>
        <span class="n">qicore</span><span class="o">.</span><span class="n">copyToLocal</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">fileLocation</span><span class="p">)</span>

        <span class="c"># We don&#39;t need the remote access anymore.</span>
        <span class="k">del</span> <span class="nb">file</span>

        <span class="c"># Now work on the file located at `fileLocation`.</span>
        <span class="n">workOnFile</span><span class="p">(</span><span class="n">fileLocation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="observe-the-progression-of-a-file-copy-transfer-or-other-long-operations">
<h3>Observe the progression of a file copy, transfer or other long operations<a class="headerlink" href="#observe-the-progression-of-a-file-copy-transfer-or-other-long-operations" title="Permalink to this headline">¶</a></h3>
<p>Potentially long file operations like <a class="reference internal" href="../cpp/file.html#qi::copyToLocal__FilePtr.Path" title="qi::copyToLocal"><code class="xref cpp cpp-guess docutils literal"><span class="pre">copyToLocal</span></code></a>
block until the end of the operation except if it is called with <code class="xref cpp cpp-guess docutils literal"><span class="pre">_async=True</span></code> as parameter
which will make the function return a <a class="reference internal" href="future.html#api-py-future"><span>qi.Future</span></a>.</p>
<p>To wait for the end of the operation, we just wait for the future to be set (after
<a class="reference internal" href="#api-py-file-import"><span>loading qicore module</span></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">printFinished</span><span class="p">():</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;File Transfer Finished!&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fetchFile</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span> <span class="c"># file is a qicore.File instance</span>

    <span class="n">temporaryFilePath</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">makeTemporaryFilePath</span><span class="p">()</span>

    <span class="c"># We copy the file on a temporary work location on the local filesystem,</span>
    <span class="c"># but we don&#39;t wait for the transfer to end.</span>
    <span class="n">transfer</span> <span class="o">=</span> <span class="n">qicore</span><span class="o">.</span><span class="n">copyToLocal</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">temporaryFilePath</span><span class="p">)</span> <span class="c"># transfer is a qi.Future</span>

    <span class="c"># We want to log the end of the transfer:</span>
    <span class="n">transfer</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">printFinished</span><span class="p">)</span>

    <span class="c"># Do some additional work while the file is transfered.</span>
    <span class="n">someAdditionalWork</span><span class="p">()</span>

    <span class="c"># Now we wait until the end of the operation if it&#39;s not finished yet.</span>
    <span class="n">transfer</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c"># Don&#39;t wait for futures in real code, you should use .then() instead.</span>
    <span class="k">del</span> <span class="nb">file</span>
    <span class="k">del</span> <span class="n">transfer</span>

    <span class="n">workOnFile</span><span class="p">(</span><span class="n">temporaryFilePath</span><span class="p">)</span>
</pre></div>
</div>
<p>(This is a partial example, see <a class="reference internal" href="../cpp/file.html#api-file-complete-example"><span>Complete example : Alice&#8217;s Image Store Service</span></a> for complete working examples.)</p>
<p>In this example we want to be notified about the end of the operation,
so we can connect a callback to the future.
However, using only a future, we cannot get progress information about the transfer.</p>
<p>To get progress information and be able to connect callbacks to the different steps of the operation
before the operation starts,
we can use the <a class="reference internal" href="../cpp/file.html#qi::FileCopyToLocal" title="qi::FileCopyToLocal"><code class="xref cpp cpp-guess docutils literal"><span class="pre">FileCopyToLocal</span></code></a> type instead
of <a class="reference internal" href="../cpp/file.html#qi::copyToLocal__FilePtr.Path" title="qi::copyToLocal"><code class="xref cpp cpp-guess docutils literal"><span class="pre">copyToLocal</span></code></a> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">printStatus</span><span class="p">(</span><span class="n">status</span><span class="p">):</span> <span class="c"># see C++ API qi.FileOperation.Status for values</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>                        <span class="c"># Status_Finished</span>
        <span class="n">qi</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;File Transfer Finished!&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>                      <span class="c"># Status_Failed</span>
        <span class="n">qi</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;File Transfer Failed!&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>                      <span class="c"># Status_Canceled</span>
        <span class="n">qi</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;File Transfer Canceled!&quot;</span><span class="p">)</span>

  <span class="c"># We ignore the other status.</span>

<span class="k">def</span> <span class="nf">printProgress</span><span class="p">(</span><span class="n">progress</span><span class="p">):</span>
    <span class="n">qi</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;#### File Transfer Progress = {0}%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">progressValue</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">fetchFile</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span> <span class="c"># file is a qicore.File instance</span>
    <span class="n">temporaryFilePath</span> <span class="o">=</span> <span class="n">makeTemporaryFilePath</span><span class="p">()</span>

    <span class="c"># Instead of launching the copy immediately, we prepare it by setting up</span>
    <span class="c"># the object which represent that operation.</span>
    <span class="n">fileCopy</span> <span class="o">=</span> <span class="n">qicore</span><span class="o">.</span><span class="n">FileCopyToLocal</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">temporaryFilePath</span><span class="p">)</span>

    <span class="c"># We extract the progress notifier associated with the operation.</span>
    <span class="n">notifier</span> <span class="o">=</span> <span class="n">fileCopy</span><span class="o">.</span><span class="n">notifier</span><span class="p">()</span>

    <span class="c"># We want to log the state changes of the transfer.</span>
    <span class="n">notifier</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">printStatus</span><span class="p">)</span>

    <span class="c"># We also to log the progress of the transfer.</span>
    <span class="n">notifier</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">printProgress</span><span class="p">)</span>

    <span class="c"># We are ready to launch the copy now.</span>
    <span class="n">ft</span> <span class="o">=</span> <span class="n">fileCopy</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="c"># Do some additional work while the file is transfered.</span>
    <span class="n">someAdditionalWork</span><span class="p">()</span>

    <span class="c"># Now we wait until the end of the operation if it&#39;s not finished yet.</span>
    <span class="n">ft</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span> <span class="c"># Don&#39;t wait for futures in real code, you should .connect()</span>
              <span class="c"># or its alternatives instead.</span>

    <span class="c"># We don&#39;t need the file access anymore.</span>
    <span class="k">del</span> <span class="nb">file</span>

    <span class="n">workOnFile</span><span class="p">(</span><span class="n">temporaryFilePath</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../cpp/file.html#qi::FileCopyToLocal" title="qi::FileCopyToLocal"><code class="xref cpp cpp-guess docutils literal"><span class="pre">FileCopyToLocal</span></code></a> type is an implementation
of <a class="reference internal" href="../cpp/file.html#qi::FileOperation" title="qi::FileOperation"><code class="xref cpp cpp-guess docutils literal"><span class="pre">FileOperation</span></code></a> which represents the copy/transfer
operation which is not started upon creation.
As this example demonstrates, the user can then plug callbacks to signals and properties provided
by <a class="reference internal" href="../cpp/file.html#qi::ProgressNotifier" title="qi::ProgressNotifier"><code class="xref cpp cpp-guess docutils literal"><span class="pre">ProgressNotifier</span></code></a> which is provided by
the <a class="reference internal" href="../cpp/file.html#qi::FileOperation::notifierC" title="qi::FileOperation::notifier"><code class="xref cpp cpp-guess docutils literal"><span class="pre">FileOperation.notifier()</span></code></a> member function.
The user can then start the copy operation by calling the
<a class="reference internal" href="../cpp/file.html#qi::FileOperation::start" title="qi::FileOperation::start"><code class="xref cpp cpp-guess docutils literal"><span class="pre">FileOperation.start()</span></code></a> member function.</p>
<p>Similarly, the side of the code which opened the file and provided access to it can also follow
the progression of the on-going operations on the file by using
the <a class="reference internal" href="../cpp/file.html#qi::File::operationProgressC" title="qi::File::operationProgress"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File.operationProgress()</span></code></a> member function.
This function provides access to a <a class="reference internal" href="../cpp/file.html#qi::ProgressNotifier" title="qi::ProgressNotifier"><code class="xref cpp cpp-guess docutils literal"><span class="pre">ProgressNotifier</span></code></a> which is updated by the
current file operation on the file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">printStatus</span><span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="c"># as before</span>
<span class="k">def</span> <span class="nf">printProgress</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span> <span class="c"># as before</span>

<span class="k">def</span> <span class="nf">storeFile</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pathToFileToStore</span><span class="p">):</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="n">qicore</span><span class="o">.</span><span class="n">openLocalFile</span><span class="p">(</span><span class="n">pathToFileToStore</span><span class="p">)</span>

    <span class="c"># Before sending the access to the file, connect progress logging callbacks.</span>
    <span class="n">copyProgress</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">operationProgress</span><span class="p">()</span>
    <span class="n">copyProgress</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">printStatus</span><span class="p">)</span>
    <span class="n">copyProgress</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">printProgress</span><span class="p">)</span>

    <span class="c"># Now we can share reading access to this file.</span>
    <span class="n">service</span><span class="o">.</span><span class="n">storeFile</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="c"># At this point, the service have a copy of the file and can start to work with it.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="complete-example-alice-s-image-store-service">
<span id="api-py-file-complete-example"></span><h2>Complete example : Alice&#8217;s Image Store Service<a class="headerlink" href="#complete-example-alice-s-image-store-service" title="Permalink to this headline">¶</a></h2>
<p>The following code samples are extracted from the complete example project located
in the worktree at sdk/libqicore/libqicore/example/file/</p>
<p>In this example, Alice designs a service which provides storage for image files.
Then Bob writes an application which accesses Alice&#8217;s image storage service and works with it.</p>
<div class="section" id="imagestore">
<h3>ImageStore<a class="headerlink" href="#imagestore" title="Permalink to this headline">¶</a></h3>
<p>Alice&#8217;s ImageStore service is simple and straightforward.
It is very similar to the example code in previous sections.</p>
<p>In particular:</p>
<p>Note the <a class="reference internal" href="../cpp/file.html#qi::File" title="qi::File"><code class="xref cpp cpp-guess docutils literal"><span class="pre">File</span></code></a> usage which allows the user to provide access to a file,
or to acquire a stored file access. See <a class="reference external" href="../../../../../../../work/master/doc/general/source/qibuild/dev/libqi/api/python/file.html#api-py-file-import" title="(in qiBuild v3.11.18)"><span class="xref std std-ref">api-py-file-import</span></a> for importing qicore module.</p>
<p>To implement the <code class="xref cpp cpp-guess docutils literal"><span class="pre">store_image</span></code> function, Alice first acquires and copies the user file
in a temporary location, then does some work to register it in the store&#8217;s database.</p>
<p>This is of course a simpler implementation, similar to the <code class="xref cpp cpp-guess docutils literal"><span class="pre">get_image()</span></code> function implementation.</p>
</div>
<div class="section" id="imagestore-user-code">
<h3>ImageStore User Code<a class="headerlink" href="#imagestore-user-code" title="Permalink to this headline">¶</a></h3>
<p>Meanwhile, Bob wrote his application to acquire Alice&#8217;s ImageStore instance,
then do some basic work with it.</p>
</div>
<div class="section" id="full-sources">
<h3>Full Sources<a class="headerlink" href="#full-sources" title="Permalink to this headline">¶</a></h3>
<p>imagestore.py:</p>
<p>file_example.py:</p>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          
            
              <div class="yui-b" id="sidebar">
                
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contents.html">Site map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../news/index.html">What’s new</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index_dev_guide.html">NAOqi - Developer guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting_started/creating_applications/index.html">Creating an application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ref/life/index.html">Programming for a living robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting_started/index_tuto.html">Other tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/choregraphe/index.html">Choregraphe Suite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../programming_index.html">SDKs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../naoqi/index.html">NAOqi APIs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">qi Framework</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">API References</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../cpp/index.html">C++ qi API Reference</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Python qi API reference</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="application.html">qi.Application API</a></li>
<li class="toctree-l5"><a class="reference internal" href="clock.html">qi clock API</a></li>
<li class="toctree-l5"><a class="reference internal" href="logging.html">qi.logging API</a></li>
<li class="toctree-l5"><a class="reference internal" href="path.html">qi.path API</a></li>
<li class="toctree-l5"><a class="reference internal" href="session.html">qi.Session API</a></li>
<li class="toctree-l5"><a class="reference internal" href="future.html">qi.Future API</a></li>
<li class="toctree-l5"><a class="reference internal" href="signal.html">qi.Signal API</a></li>
<li class="toctree-l5"><a class="reference internal" href="property.html">qi.Property API</a></li>
<li class="toctree-l5"><a class="reference internal" href="types.html">qi.Types* API</a></li>
<li class="toctree-l5"><a class="reference internal" href="bind.html">Bind API</a></li>
<li class="toctree-l5"><a class="reference internal" href="async.html">qi.async, qi.PeriodicTask API</a></li>
<li class="toctree-l5"><a class="reference internal" href="translator.html">qi.Translator API</a></li>
<li class="toctree-l5"><a class="reference internal" href="module.html">qi.Module API</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="">qicore.File</a><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../transtyping.html">&gt; Type equivalences between languages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../guide/index.html">Hands-on Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../design/index.html">Design Documents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../internal/typesystem.html">Type system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../internal/object.html">Object type erasure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../internal/template.html">Registering template types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../internal/call.html">Call code path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../internal/messaging.html">Messaging system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog/index.html">qi Framework - ChangeLog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../changelog/interface.html">qi Framework - Deprecation history</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ref/index.html">Former NAOqi Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../simulators/simulator_index.html">Simulators</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../home_nao.html"><strong>NAO</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../home_pepper.html"><strong>Pepper</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../home_romeo.html"><strong>Romeo</strong> - Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../legal/notice.html">Legal notices</a></li>
</ul>

    <div id="on-this-page" style="display:none;">
        <h2 id="otp-link">On this page</h2>
        <div id="toc-list">
            <ul>
<li><a class="reference internal" href="#">qicore.File</a><ul>
<li><a class="reference internal" href="#summary">Summary</a></li>
<li><a class="reference internal" href="#reference">Reference</a></li>
<li><a class="reference internal" href="#detailed-usage-description">Detailed Usage Description</a><ul>
<li><a class="reference internal" href="#opening-a-file-in-read-only-mode-for-sharing-access">Opening a file in read-only mode for sharing access</a></li>
<li><a class="reference internal" href="#file-access-lifetime">File access lifetime</a></li>
<li><a class="reference internal" href="#request-or-provide-read-only-access-to-the-content-of-a-file">Request or provide read-only access to the content of a file</a></li>
<li><a class="reference internal" href="#make-a-local-copy-of-a-provided-file">Make a local copy of a provided file</a></li>
<li><a class="reference internal" href="#observe-the-progression-of-a-file-copy-transfer-or-other-long-operations">Observe the progression of a file copy, transfer or other long operations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#complete-example-alice-s-image-store-service">Complete example : Alice&#8217;s Image Store Service</a><ul>
<li><a class="reference internal" href="#imagestore">ImageStore</a></li>
<li><a class="reference internal" href="#imagestore-user-code">ImageStore User Code</a></li>
<li><a class="reference internal" href="#full-sources">Full Sources</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
    </div>
        </div>
      </div>
              </div>
            
          
        </div>
    </main>
    <a href="#0" class="cd-top"></a>
    <div id="ft">
      
      <a title="Glossary" href="../../../../glossary.html">Glossary</a>
      <a title="Site map" href="../../../../contents.html">Site map</a>
      <a title="Index" href="../../../../genindex.html">Index</a>
      <a title="Support" target="_blank" href="https://account.aldebaran.com/support/">Support</a>
      <a title="Contact" target="_blank" href="https://www.aldebaran.com/en/contact">Contact</a>
      <a title="Legal Notices" href="../../../../legal/notice.html">Legal Notices</a>
      
      
      <img src="https://www.ald.softbankrobotics.com/sites/aldebaran/files/logos-picture/2016_digital_logo_sbr_112x31_0.png" alt="">
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>