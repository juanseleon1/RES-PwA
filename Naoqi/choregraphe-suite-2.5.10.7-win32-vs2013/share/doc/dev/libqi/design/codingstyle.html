<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Coding Convention &mdash; Aldebaran 2.5.9.8-r3 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.5.9.8-r3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="Aldebaran 2.5.9.8-r3 documentation" href="../../../index.html" />
    <link rel="up" title="Design Documents" href="index.html" />
    <link rel="next" title="Type system" href="../internal/typesystem.html" />
    <link rel="prev" title="Network Binary Protocol" href="network-binary-protocol.html" />
 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115894784-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115894784-1');
</script>

<script type="text/javascript" src="https://cloud.aldebaran-robotics.com/static/js/topbar.js"></script>
<style>
div#hd::after {
  
  
  content: 'NAOqi 2.5';
  
  
  
  position: absolute;
  margin-top: -54px;
  right: -4px;
  font-size: 125%;
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
  -o-transform: rotate(45deg);
  transform: rotate(45deg);
  }
</style>
<script>

$(window).ready(function () {

    //Aldebaran Top bar
     var barLinks = [];
     barLinks.push({'name':'Aldebaran Site', 'url':'http://www.aldebaran-robotics.com', 'click':'', 'img':'https://cloud.aldebaran-robotics.com/static/img/aldeb.png'});
     barLinks.push({'name':'Documentation', 'url':'../../../index.html', 'click':"", 'img':''});
     function ShowBar(name, email, usertype) {
        var barParams = {
            'name'    : name,
            'email'   : email,
            'usertype': usertype,
            'loginfct': "FctLogin"
        }
        try { InitTopBar(barParams, barLinks); } catch (e) { console.log('Top Bar Init Failed'); }
    }
    ShowBar();

    var width_label = 0;
    $('dl.function-index dt > span').each(function () {
        $(this).css('width', 'auto');
        width_label = Math.max(width_label, $(this).width());
    }).width(width_label + 30);
    $('.sig-paren').width('auto');

    // first level navigation

    var buttonIds = [".naoqi", "pepper", "nao", "romeo"];
    for(id in buttonIds){
        $(id).removeClass("active");
    }
    //Aldebaran project
    if ($('.toctree-l1.current a').text().indexOf("Romeo ")==0){
        $(".romeo").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Pepper ")==0){
        $(".pepper").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("NAO ")==0){
        $(".nao").toggleClass('active');
    }
    else if($('.toctree-l1.current a').text().indexOf("NAOqi ")==0){
        $(".naoqi").toggleClass('active');
    }

    //qibuild project
    if ($('.toctree-l1.current a').text().indexOf("Welcome to qiBuild documentation !")==0){
        $(".beginner").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Advanced qibuild usage")==0){
        $(".advanced").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Hacking qiBuild")==0){
        $(".hacking").toggleClass('active');
    }

    // add "On this page", add cssClasses
    if($('.yui-g .section h1').length > 0){
        $('.yui-g .section h1:first').addClass("titleWrapper");
        $('.yui-g .section h1:first').after($("#on-this-page").html())
    }
    else if($('.yui-g .section h2').length > 0){
        $('.yui-g .section h2:first').addClass("titleWrapper");
        $('.yui-g .section h2:first').after($("#on-this-page").html())
    }
    //remove first element on this page
    if($("#on-this-page").length > 0){
        var doms = $(".yui-g .section :first").nextUntil("#toc-list");
        doms = doms.add($("#toc-list"));
        doms.wrapAll('<div class="iNavWrapper"></div>');
        $("#toc-list ul li a:first").remove()
        $("#toc-list ul:first").replaceWith($("#toc-list ul li").html())
    }
    $("#toc-list").hide();
    $("#otp-link").click(function(){
        $("#toc-list").slideToggle();
        if($("h2#otp-link").hasClass("change-before")){
            $("h2#otp-link").removeClass("change-before")
        }
        else{
            $("h2#otp-link").addClass("change-before")
        }
    });

    if($("a.current.reference.internal").length>0){
        var left = $("a.current.reference.internal").position().left-1;
        var width = $("a.current.reference.internal").width();
        var offset = 51;
        var sidebarWidth = 339;
        var right = sidebarWidth - (left + width + offset);
        if($("a.current.reference.internal").height() <= 15){
            $("a.current.reference.internal").css("white-space","nowrap");
            $("a.current.reference.internal").css({"backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        else{
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
            left = $("a.current.reference.internal").position().left-1;
            width = $("a.current.reference.internal").width();
            right = sidebarWidth - (left + width + offset);
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        $("a.current.reference.internal").parent().css("list-style-type","none");
    }

    //back to top
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700;
    //grab the "back to top" link
    var back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
        //back to top button
        ( $(this).scrollTop() > offset ) ? back_to_top.addClass('cd-is-visible') : back_to_top.removeClass('cd-is-visible cd-fade-out');
        if( $(this).scrollTop() > offset_opacity ) {
            back_to_top.addClass('cd-fade-out');
        }
    });

    //smooth scroll to top
    back_to_top.click(function(event){
        event.preventDefault();
        $('body,html').animate({
            scrollTop: 0 ,
        }, scroll_top_duration
        );
    });
    //add show source button

    //replace "go" with "search"
    $("#searchbox form input[type=submit]").val("Search")

    //trigger click on version triangle to jump to whats new
    $("#hd").click(function(e){if(e.pageX >= this.offsetWidth && e.pageY<120){$(".whatsnew")[0].click()}})
})

</script>


  </head>
  <body role="document">

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      
      <h1><a href="../../../index.html">SoftBank Robotics documentation</a>
      
      
      <span><a class="whatsnew" href="../../../news/index.html" >
      
          What's new in NAOqi 2.5?
      
      </a></span>
      
      </h1>
      <div id="global-nav">
        
        <a class="naoqi" title="NAOqi Developer guide" href="../../../index_dev_guide.html">NAOqi</a>
        <a class="pepper" title="Pepper documentation" href="../../../home_pepper.html">Pepper</a>
        <a class="nao" title="NAO documentation" href="../../../home_nao.html">NAO</a>
        <a class="romeo" title="Romeo Documentation" href="../../../home_romeo.html">Romeo</a>
        
        
        
        <div class="nav">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script></div>
      </div>

    </div>
    <main class="cd-container">
        <div id="bd">
          <div id="yui-main">
            <div class="yui-b">
              <div class="yui-g" id="dev-libqi-design-codingstyle">
                
  <div class="section" id="coding-convention">
<span id="std-code-convention"></span><h1>Coding Convention<a class="headerlink" href="#coding-convention" title="Permalink to this headline">¶</a></h1>
<div class="section" id="backward-compatibility">
<h2>Backward Compatibility<a class="headerlink" href="#backward-compatibility" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Qt API Design Principles</dt>
<dd><a class="reference external" href="http://wiki.qt-project.org/API_Design_Principles">http://wiki.qt-project.org/API_Design_Principles</a></dd>
<dt>Qt ABI thoughts</dt>
<dd><a class="reference external" href="http://labs.qt.nokia.com/2009/08/12/some-thoughts-on-binary-compatibility/">http://labs.qt.nokia.com/2009/08/12/some-thoughts-on-binary-compatibility/</a></dd>
<dt>C++ Tips and Tricks for Mac OS X</dt>
<dd><a class="reference external" href="https://developer.apple.com/library/mac/#technotes/tn2185/_index.html">https://developer.apple.com/library/mac/#technotes/tn2185/_index.html</a></dd>
<dt>Potential Errors Passing CRT Objects Across DLL Boundaries</dt>
<dd><a class="reference external" href="http://msdn.microsoft.com/en-us/library/ms235460.aspx">http://msdn.microsoft.com/en-us/library/ms235460.aspx</a></dd>
</dl>
</div>
<div class="section" id="naming-convention">
<h2>Naming convention<a class="headerlink" href="#naming-convention" title="Permalink to this headline">¶</a></h2>
<p>Headers go into &lt;libname&gt;/*</p>
<ul class="simple">
<li>we want the same layout when headers are installed and are in the source tree</li>
<li>we want to prefix by the library name to avoid headers clash, remember that we want to install in /usr/include sometimes</li>
</ul>
<p>Sources and private headers goes into &lt;src&gt;/*</p>
<ul class="simple">
<li>That allows us to isolate public code that need a particular attention</li>
<li>It&#8217;s easier to grep only in public headers</li>
</ul>
<p>Private classes go into &lt;src&gt;/*</p>
<p>Private implementation headers should be named &#8216;&lt;classname&gt;_p.hpp&#8217;</p>
<ul class="simple">
<li>this distinguishes public and private headers, otherwise we can have two files with the same name which is not pratical.</li>
<li>furthermore this denotates that the content should never be public, it&#8217;s the private part of a class.</li>
<li>Qt classes are not in a namespace</li>
<li>Qt classes are prefixed with &#8216;Qi&#8217;</li>
</ul>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>For the public <em>foo</em> class and the private <em>oups</em> class in the <em>bar</em> library we have:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="go">bar/foo.hpp</span>

<span class="go">src/foo.cpp</span>
<span class="go">src/foo_p.hpp</span>
<span class="go">src/oups.cpp</span>
<span class="go">src/oups.hpp</span>
<span class="go">src/oups_p.hpp (optional)</span>

<span class="go">bar/qt/qifoo.h</span>

<span class="go">src/qifoo.cpp</span>
<span class="go">src/qifoo_p.h</span>
</pre></div>
</div>
<p>This gives us the following objects:</p>
<p>STL:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;bar/foo.hpp&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">qi</span><span class="o">::</span><span class="n">Foo</span> <span class="n">foo</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>QT:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;bar/qt/qifoo.h&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">QiFoo</span> <span class="n">foo</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="headers">
<h2>Headers<a class="headerlink" href="#headers" title="Permalink to this headline">¶</a></h2>
<p>Public headers must not include public headers from other libraries. This
ensures binary compatibility.</p>
<p>Public headers must be enclosed within brackets &lt;&gt; when included.</p>
<p>On the other hand, private headers must be enclosed within double quotes &#8220;&#8221; when
included.</p>
</div>
<div class="section" id="header-include-statement">
<h2>Header include statement<a class="headerlink" href="#header-include-statement" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">If a header is <strong>not provided by the project</strong>, then the include statement
<strong>must</strong> be:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;bar/foo.h&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Else if a header is <strong>provided by the project</strong> and <strong>gets installed</strong>, so this is a
<em>public header</em>, then the include statement <strong>must</strong> be:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;bar/foo.h&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Otherwise, this is a <em>private header</em> <strong>provided by the project</strong> and
<strong>only used in this project</strong> (e.i. <em>never gets installed</em>), then the include
statement <strong>must</strong> be:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &quot;bar/foo.h&quot;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="export-symbol">
<h2>Export symbol<a class="headerlink" href="#export-symbol" title="Permalink to this headline">¶</a></h2>
<p>All public functions and classes should be exported using &lt;LIBNAME&gt;_API macro. This macro should be unique to the library and never be used by others libraries.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include &lt;bar/api.hpp&gt;</span>

<span class="k">class</span> <span class="nc">BAR_API</span> <span class="n">Foo</span>
<span class="p">{</span>
<span class="p">};</span>
</pre></div>
</div>
<p>For each library you will have to define &lt;library&gt;/api.hpp</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#pragma once</span>
<span class="cp">#ifndef BAR_API_HPP_</span>
<span class="cp">#define BAR_API_HPP_</span>

<span class="cp">#include &lt;qi/macro.hpp&gt;</span>

<span class="cp">#define BAR_API QI_LIB_API(bar)</span>

<span class="cp">#endif  </span><span class="c1">// !BAR_API_HPP_</span>
</pre></div>
</div>
<p>Please remember to export nested class</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">class</span> <span class="nc">BAR_API</span> <span class="n">Foo</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Foo</span><span class="p">();</span>
  <span class="o">~</span><span class="n">Foo</span><span class="p">();</span>

  <span class="k">class</span> <span class="nc">BAR_API</span> <span class="n">Bar</span> <span class="c1">// BAR_API is mandatory here</span>
  <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="n">Bar</span><span class="p">();</span>
    <span class="o">~</span><span class="n">Bar</span><span class="p">();</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="private-implementation">
<h2>Private Implementation<a class="headerlink" href="#private-implementation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Use private implementation where applicable.</li>
<li>Still reserve a pointer instead if you dont use it. (for future use, see
example two).</li>
<li>Classes should be named &lt;classname&gt;Private.</li>
<li>A pointer &#8216;_p&#8217; should be added into the class.</li>
</ul>
<p>When a class has a private implementation, the copy constructor <em>must</em> be either
implemented, either disabled - <em>ie.</em> defined in the private section of the class.</p>
<div class="section" id="example-with-pimpl">
<h3>Example with Pimpl<a class="headerlink" href="#example-with-pimpl" title="Permalink to this headline">¶</a></h3>
<p>bar/foo.hpp:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FooPrivate</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Foo</span>
<span class="p">{</span>
  <span class="n">FooPrivate</span><span class="o">*</span> <span class="n">_p</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="example-without-pimpl">
<h3>Example without Pimpl<a class="headerlink" href="#example-without-pimpl" title="Permalink to this headline">¶</a></h3>
<div class="highlight-cpp"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>

<span class="k">protected</span><span class="o">:</span>
  <span class="c1">//could be used to create a future pimpl if needed without breaking ABI</span>
  <span class="kt">void</span><span class="o">*</span> <span class="n">_reserved</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">_mymember</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="struct">
<h2>Struct<a class="headerlink" href="#struct" title="Permalink to this headline">¶</a></h2>
<p>You can expose struct but they should only contains POD. If a struct have a member
which a class (or worst) a STL class, Windows wont be happy, and you will have to link
the exe and the dll with the same VC runtime, in the same configuration (release/debug).
Prefer Pimpl in this case.</p>
</div>
<div class="section" id="exception">
<h2>Exception<a class="headerlink" href="#exception" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://stackoverflow.com/questions/4756944/c-dll-plugin-interface/4757105#4757105">http://stackoverflow.com/questions/4756944/c-dll-plugin-interface/4757105#4757105</a></p>
<p>Exceptions issues:</p>
<ul class="simple">
<li>may not be available on all platforms</li>
<li>it&#8217;s not really compatible with asynchronous design, where error reporting should
be asynchronous too, but the error can catch at the caller place, and re-throw
at the callee place. (qi::Future can help having both)</li>
<li>exceptions increase the library size</li>
<li>it&#8217;s really hard to write exception-safe code. (RAII really help here)</li>
<li>Exception catching of a user defined type in a binary other than the one which
threw the exception requires a typeinfo lookup.
(and rtti do not work well across dll boundary <a class="reference external" href="http://gcc.gnu.org/faq.html#dso">http://gcc.gnu.org/faq.html#dso</a>)</li>
<li>it break ABI: memory allocated in one place should be deallocated in the same place
(remember that object do not have the same size in release/debug with MSVC),
so if user catch a ref, this can crash.</li>
<li>Avoiding leak is really hard (all function should handle exceptions, again RAII really help)</li>
</ul>
<p>Example:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">A</span><span class="o">*</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="n">A</span><span class="p">();</span>
<span class="c1">// this leak a A*</span>
<span class="n">functionthatthrow</span><span class="p">();</span>
<span class="k">delete</span> <span class="n">a</span><span class="p">;</span>
</pre></div>
</div>
<p>This could be fixed with a RAII smart pointer class:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// this could be rewriten with smart pointer to avoid error</span>
<span class="n">boost</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">boost</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="p">();</span>

<span class="n">functionthatthrow</span><span class="p">();</span>
<span class="c1">// a is cleanup here whatever happened.</span>
</pre></div>
</div>
<p>even more vicious:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// GenericObject that throw in operator= sometime</span>
<span class="k">class</span> <span class="nc">EvilObject</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">list</span><span class="o">&lt;</span><span class="n">EvilObject</span><span class="o">&gt;</span> <span class="n">evilList</span><span class="p">;</span>

<span class="c1">// simple function, that do not look evil, but can throw nevertheless,</span>
<span class="c1">// but can you guess what?</span>
<span class="kt">void</span> <span class="nf">functionthatdonotthrow</span><span class="p">(</span><span class="k">const</span> <span class="n">EvilObject</span><span class="o">&amp;</span> <span class="n">eo</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">evilList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">eo</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">EvilObject</span><span class="o">*</span> <span class="n">eo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EvilObject</span><span class="p">;</span>
  <span class="c1">// leak, but you can&#39;t guess that reading functionthatdonotthrow</span>
  <span class="n">functionthatdonotthrow</span><span class="p">(</span><span class="o">*</span><span class="n">eo</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once you have exception you should use RAII everywhere to avoid leak.</p>
<p>So use exception with caution and prefer a simple hierarchy over a complicated one.
Do not hesitate to use std::runtime_error.
Never throw an exception not defined in your lib, except the one provided by the stdexcept header.</p>
</div>
<div class="section" id="iterators">
<h2>Iterators<a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h2>
<p>When naming an iterator, simply append &#8220;It&#8221; after the name of the container.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">primeNumbers</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">primeNumbersIt</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="enum">
<h2>Enum<a class="headerlink" href="#enum" title="Permalink to this headline">¶</a></h2>
<p>The name of the enumeration must be singular.</p>
<p>The enumeration values must be prefixed by the name of the enumeration followed by an underscore.</p>
<p>Precise each number and never reorder existing enumerations for ABI compatibility.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Message</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">enum</span> <span class="n">Type</span>
  <span class="p">{</span>
    <span class="n">Type_Call</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Type_Error</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">Type_Answer</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">Type_Event</span> <span class="o">=</span> <span class="mi">3</span>
  <span class="p">};</span>

<span class="p">};</span>
</pre></div>
</div>
<p>Always prefer enumerations to booleans for readability.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// bad: cannot understand just by reading the line</span>
<span class="n">Client</span> <span class="nf">ds</span><span class="p">(</span><span class="s">&quot;ip&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="c1">// GOOD: easy to read, ok this is keepalive.</span>
<span class="n">Client</span> <span class="nf">ds</span><span class="p">(</span><span class="s">&quot;ip&quot;</span><span class="p">,</span> <span class="n">Connection_KeepAlive</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="members">
<h2>Members<a class="headerlink" href="#members" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Private members names should be prefixed with underscores.</li>
</ul>
</div>
<div class="section" id="arguments">
<h2>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h2>
<p>If the argument is IN-OUT then use pointer and avoid reference. The code that use the function is clearer to look at.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">result</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">check</span><span class="p">;</span>

<span class="c1">// the &amp; show that the value can be modified</span>
<span class="n">check</span> <span class="o">=</span> <span class="n">computeButCanFail</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">);</span>

<span class="c1">//bad... we dont know value will be modified</span>
<span class="n">check</span> <span class="o">=</span> <span class="n">computeButCanFail</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
</pre></div>
</div>
<p>If the type is a POD (bool, char, short, int, float, double, etc...) use:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">setValue</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">);</span>
</pre></div>
</div>
<p>In all other case use const ref.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">setValue</span><span class="p">(</span><span class="k">const</span> <span class="n">MyClass</span><span class="o">&amp;</span> <span class="n">myclass</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="virtual">
<h2>Virtual<a class="headerlink" href="#virtual" title="Permalink to this headline">¶</a></h2>
<p>All class with virtuals should have a virtual destructor to avoid leak.</p>
</div>
<div class="section" id="interface">
<h2>Interface<a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h2>
<p>Always declare the destructor of an interface pure virtual.</p>
<p>(and provide an implementation to make it compile).</p>
<p>An interface should not be instanciable, so forcing the destrutor to be pure is good.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SocketInterface</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// pure virtual destructor</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">SocketInterface</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">onReadyRead</span><span class="p">();</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="pointers">
<h2>pointers<a class="headerlink" href="#pointers" title="Permalink to this headline">¶</a></h2>
<p>They should never be used to return data to users.
Implement fast copy constructor and operator=. Rely on swap semantic if needed.</p>
<dl class="docutils">
<dt>Rational:</dt>
<dd>Allocation should always be done in the same &#8220;space&#8221;, a library should malloc and free his structure, user code too. Under windows structure do not have the same size between debug and release, this lead to release library not usable in debug build.</dd>
</dl>
<p>** pointer should only be used as input parameter, to pass an array of pointer.</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// BAD an object is created in the socket library, but should be released</span>
<span class="c1">// in the client program</span>
<span class="n">Message</span><span class="o">*</span> <span class="n">msg</span><span class="p">;</span>
<span class="n">socket</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-c++"><div class="highlight"><pre><span class="c1">// Good, user provide a message to fill</span>
<span class="n">Message</span> <span class="n">msg</span><span class="p">;</span>
<span class="n">socket</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="assert-exit">
<h2>Assert/Exit<a class="headerlink" href="#assert-exit" title="Permalink to this headline">¶</a></h2>
<p>** Basically you should only use assert for something that according to you the developer when you write the assert CANNOT POSSIBLY BE FALSE.</p>
<ul class="simple">
<li>do not call assert when the error is not fatal.</li>
<li>never call exit in a library.</li>
</ul>
<p>Report error to the user of the library if possible instead. Users are then free
to assert/exit as they want. A library should never crash a program deliberately.</p>
<p>assert is only active during debug, you may think that it is enough to use it,
but some developper use debug build, and they do not
want their program to crash because of a lib that do not handle errors correctly.</p>
<p>You should really be careful with assert, the goal is to catch error before a segfault,
to point at the real error, instead of a random segfault. So use with caution.</p>
<p>A borderline example:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">inotify_event</span><span class="o">&amp;</span> <span class="n">evt</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">inotify_event</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">evt</span><span class="p">..</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">IN_CREATE</span><span class="p">)</span> <span class="p">{...}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">evt</span><span class="p">.</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="n">IN_STUFF</span><span class="p">)</span> <span class="p">{...}</span>
 <span class="o">&lt;</span><span class="p">..</span><span class="o">&gt;</span>
<span class="k">else</span> <span class="n">assert</span><span class="p">(</span><span class="o">!</span><span class="s">&quot;inotify event type unknown&quot;</span><span class="p">);</span>

<span class="c1">// this one is wrong, if inotify api evolves some new message types may appear. This can happen and is not fatal to the code.</span>
</pre></div>
</div>
</div>
<div class="section" id="coding-style">
<h2>Coding Style<a class="headerlink" href="#coding-style" title="Permalink to this headline">¶</a></h2>
<p>We use clang-format (version 3.6.0) to format our c++ files. If you want more information about clang-format take a look to
<a class="reference external" href="http://clang.llvm.org/docs/ClangFormat.html">http://clang.llvm.org/docs/ClangFormat.html</a>
and
<a class="reference external" href="http://clang.llvm.org/docs/ClangFormatStyleOptions.html">http://clang.llvm.org/docs/ClangFormatStyleOptions.html</a></p>
<p>Here is the .clang-format file use for the project (files are port to this one at
a time).</p>
<div class="highlight-python"><div class="highlight"><pre>---
Language:        Cpp
# BasedOnStyle:  Google
AccessModifierOffset: -2
AlignEscapedNewlinesLeft: true
AlignTrailingComments: true
AllowAllParametersOfDeclarationOnNextLine: false
AllowShortBlocksOnASingleLine: false
AllowShortFunctionsOnASingleLine: None
AllowShortIfStatementsOnASingleLine: false
AllowShortLoopsOnASingleLine: false
AlwaysBreakBeforeMultilineStrings: true
AlwaysBreakTemplateDeclarations: true
BinPackParameters: false
# Only works for clang-format 3.7.0 (Apple)
# BinPackArguments: false
BreakBeforeBinaryOperators: false
BreakBeforeBraces: Allman
BreakBeforeTernaryOperators: false
BreakConstructorInitializersBeforeComma: true
ColumnLimit: 119
CommentPragmas: &#39;^ IWYU pragma:&#39;
ConstructorInitializerAllOnOneLineOrOnePerLine: false
ConstructorInitializerIndentWidth: 2
ContinuationIndentWidth: 4
Cpp11BracedListStyle: true
DerivePointerAlignment: false
DisableFormat: false
ExperimentalAutoDetectBinPacking: false
ForEachMacros: [ foreach, Q_FOREACH, BOOST_FOREACH ]
IndentCaseLabels: false
IndentWidth: 2
IndentWrappedFunctionNames: false
IndentFunctionDeclarationAfterType: false
KeepEmptyLinesAtTheStartOfBlocks: false
MaxEmptyLinesToKeep: 1
NamespaceIndentation: Inner
ObjCSpaceAfterProperty: false
ObjCSpaceBeforeProtocolList: false
PenaltyBreakBeforeFirstCallParameter: 100
PenaltyBreakComment: 300
PenaltyBreakString: 1000
PenaltyBreakFirstLessLess: 120
PenaltyExcessCharacter: 1000000
PenaltyReturnTypeOnItsOwnLine: 200
PointerAlignment: Left
SpaceBeforeAssignmentOperators: true
SpaceBeforeParens: ControlStatements
SpaceInEmptyParentheses: false
SpacesBeforeTrailingComments: 1
SpacesInAngles: false
SpacesInCStyleCastParentheses: false
SpacesInParentheses: false
SpaceAfterControlStatementKeyword: true
Standard: Auto
TabWidth: 8
UseTab: Never
...
</pre></div>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          
            
              <div class="yui-b" id="sidebar">
                
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contents.html">Site map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../news/index.html">What’s new</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index_dev_guide.html">NAOqi - Developer guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/creating_applications/index.html">Creating an application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ref/life/index.html">Programming for a living robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index_tuto.html">Other tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../software/choregraphe/index.html">Choregraphe Suite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../programming_index.html">SDKs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../naoqi/index.html">NAOqi APIs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">qi Framework</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../api/index.html">API References</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guide/index.html">Hands-on Guide</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Design Documents</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="network-usecase.html">Networking - Use Case</a></li>
<li class="toctree-l4"><a class="reference internal" href="network-binary-protocol.html">Network Binary Protocol</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">Coding Convention</a><ul class="simple">
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../internal/typesystem.html">Type system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/object.html">Object type erasure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/template.html">Registering template types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/call.html">Call code path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal/messaging.html">Messaging system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog/index.html">qi Framework - ChangeLog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changelog/interface.html">qi Framework - Deprecation history</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../ref/index.html">Former NAOqi Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../simulators/simulator_index.html">Simulators</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../home_nao.html"><strong>NAO</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../home_pepper.html"><strong>Pepper</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../home_romeo.html"><strong>Romeo</strong> - Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../legal/notice.html">Legal notices</a></li>
</ul>

    <div id="on-this-page" style="display:none;">
        <h2 id="otp-link">On this page</h2>
        <div id="toc-list">
            <ul>
<li><a class="reference internal" href="#">Coding Convention</a><ul>
<li><a class="reference internal" href="#backward-compatibility">Backward Compatibility</a></li>
<li><a class="reference internal" href="#naming-convention">Naming convention</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#headers">Headers</a></li>
<li><a class="reference internal" href="#header-include-statement">Header include statement</a></li>
<li><a class="reference internal" href="#export-symbol">Export symbol</a></li>
<li><a class="reference internal" href="#private-implementation">Private Implementation</a><ul>
<li><a class="reference internal" href="#example-with-pimpl">Example with Pimpl</a></li>
<li><a class="reference internal" href="#example-without-pimpl">Example without Pimpl</a></li>
</ul>
</li>
<li><a class="reference internal" href="#struct">Struct</a></li>
<li><a class="reference internal" href="#exception">Exception</a></li>
<li><a class="reference internal" href="#iterators">Iterators</a></li>
<li><a class="reference internal" href="#enum">Enum</a></li>
<li><a class="reference internal" href="#members">Members</a></li>
<li><a class="reference internal" href="#arguments">Arguments</a></li>
<li><a class="reference internal" href="#virtual">Virtual</a></li>
<li><a class="reference internal" href="#interface">Interface</a></li>
<li><a class="reference internal" href="#pointers">pointers</a></li>
<li><a class="reference internal" href="#assert-exit">Assert/Exit</a></li>
<li><a class="reference internal" href="#coding-style">Coding Style</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
        </div>
      </div>
              </div>
            
          
        </div>
    </main>
    <a href="#0" class="cd-top"></a>
    <div id="ft">
      
      <a title="Glossary" href="../../../glossary.html">Glossary</a>
      <a title="Site map" href="../../../contents.html">Site map</a>
      <a title="Index" href="../../../genindex.html">Index</a>
      <a title="Support" target="_blank" href="https://account.aldebaran.com/support/">Support</a>
      <a title="Contact" target="_blank" href="https://www.aldebaran.com/en/contact">Contact</a>
      <a title="Legal Notices" href="../../../legal/notice.html">Legal Notices</a>
      
      
      <img src="https://www.ald.softbankrobotics.com/sites/aldebaran/files/logos-picture/2016_digital_logo_sbr_112x31_0.png" alt="">
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>