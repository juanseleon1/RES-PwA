<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ALMath &mdash; Aldebaran 2.5.9.8-r3 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '2.5.9.8-r3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="Aldebaran 2.5.9.8-r3 documentation" href="../../../../index.html" />
    <link rel="up" title="Python SDK - Examples" href="../../examples.html" />
    <link rel="next" title="Sensors" href="../sensors/index.html" />
    <link rel="prev" title="Collision detection" href="../motion/collision_detection.html" />
 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115894784-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115894784-1');
</script>

<script type="text/javascript" src="https://cloud.aldebaran-robotics.com/static/js/topbar.js"></script>
<style>
div#hd::after {
  
  
  content: 'NAOqi 2.5';
  
  
  
  position: absolute;
  margin-top: -54px;
  right: -4px;
  font-size: 125%;
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
  -o-transform: rotate(45deg);
  transform: rotate(45deg);
  }
</style>
<script>

$(window).ready(function () {

    //Aldebaran Top bar
     var barLinks = [];
     barLinks.push({'name':'Aldebaran Site', 'url':'http://www.aldebaran-robotics.com', 'click':'', 'img':'https://cloud.aldebaran-robotics.com/static/img/aldeb.png'});
     barLinks.push({'name':'Documentation', 'url':'../../../../index.html', 'click':"", 'img':''});
     function ShowBar(name, email, usertype) {
        var barParams = {
            'name'    : name,
            'email'   : email,
            'usertype': usertype,
            'loginfct': "FctLogin"
        }
        try { InitTopBar(barParams, barLinks); } catch (e) { console.log('Top Bar Init Failed'); }
    }
    ShowBar();

    var width_label = 0;
    $('dl.function-index dt > span').each(function () {
        $(this).css('width', 'auto');
        width_label = Math.max(width_label, $(this).width());
    }).width(width_label + 30);
    $('.sig-paren').width('auto');

    // first level navigation

    var buttonIds = [".naoqi", "pepper", "nao", "romeo"];
    for(id in buttonIds){
        $(id).removeClass("active");
    }
    //Aldebaran project
    if ($('.toctree-l1.current a').text().indexOf("Romeo ")==0){
        $(".romeo").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Pepper ")==0){
        $(".pepper").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("NAO ")==0){
        $(".nao").toggleClass('active');
    }
    else if($('.toctree-l1.current a').text().indexOf("NAOqi ")==0){
        $(".naoqi").toggleClass('active');
    }

    //qibuild project
    if ($('.toctree-l1.current a').text().indexOf("Welcome to qiBuild documentation !")==0){
        $(".beginner").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Advanced qibuild usage")==0){
        $(".advanced").toggleClass('active');
    }
    else if ($('.toctree-l1.current a').text().indexOf("Hacking qiBuild")==0){
        $(".hacking").toggleClass('active');
    }

    // add "On this page", add cssClasses
    if($('.yui-g .section h1').length > 0){
        $('.yui-g .section h1:first').addClass("titleWrapper");
        $('.yui-g .section h1:first').after($("#on-this-page").html())
    }
    else if($('.yui-g .section h2').length > 0){
        $('.yui-g .section h2:first').addClass("titleWrapper");
        $('.yui-g .section h2:first').after($("#on-this-page").html())
    }
    //remove first element on this page
    if($("#on-this-page").length > 0){
        var doms = $(".yui-g .section :first").nextUntil("#toc-list");
        doms = doms.add($("#toc-list"));
        doms.wrapAll('<div class="iNavWrapper"></div>');
        $("#toc-list ul li a:first").remove()
        $("#toc-list ul:first").replaceWith($("#toc-list ul li").html())
    }
    $("#toc-list").hide();
    $("#otp-link").click(function(){
        $("#toc-list").slideToggle();
        if($("h2#otp-link").hasClass("change-before")){
            $("h2#otp-link").removeClass("change-before")
        }
        else{
            $("h2#otp-link").addClass("change-before")
        }
    });

    if($("a.current.reference.internal").length>0){
        var left = $("a.current.reference.internal").position().left-1;
        var width = $("a.current.reference.internal").width();
        var offset = 51;
        var sidebarWidth = 339;
        var right = sidebarWidth - (left + width + offset);
        if($("a.current.reference.internal").height() <= 15){
            $("a.current.reference.internal").css("white-space","nowrap");
            $("a.current.reference.internal").css({"backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        else{
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
            left = $("a.current.reference.internal").position().left-1;
            width = $("a.current.reference.internal").width();
            right = sidebarWidth - (left + width + offset);
            $("a.current.reference.internal").css({"float":"right","backgroundColor":"#0F2939","paddingTop":"2px", "paddingBottom":"2px","paddingLeft":left+"px","marginLeft":"-"+left+"px", "paddingRight":right+"px","marginRight":"-"+right+"px", "boxShadow":"0px 0px 1px rgb(15, 41, 57)"});
        }
        $("a.current.reference.internal").parent().css("list-style-type","none");
    }

    //back to top
    var offset = 300,
    //browser window scroll (in pixels) after which the "back to top" link opacity is reduced
    offset_opacity = 1200,
    //duration of the top scrolling animation (in ms)
    scroll_top_duration = 700;
    //grab the "back to top" link
    var back_to_top = $('.cd-top');

    //hide or show the "back to top" link
    $(window).scroll(function(){
        //back to top button
        ( $(this).scrollTop() > offset ) ? back_to_top.addClass('cd-is-visible') : back_to_top.removeClass('cd-is-visible cd-fade-out');
        if( $(this).scrollTop() > offset_opacity ) {
            back_to_top.addClass('cd-fade-out');
        }
    });

    //smooth scroll to top
    back_to_top.click(function(event){
        event.preventDefault();
        $('body,html').animate({
            scrollTop: 0 ,
        }, scroll_top_duration
        );
    });
    //add show source button

    //replace "go" with "search"
    $("#searchbox form input[type=submit]").val("Search")

    //trigger click on version triangle to jump to whats new
    $("#hd").click(function(e){if(e.pageX >= this.offsetWidth && e.pageY<120){$(".whatsnew")[0].click()}})
})

</script>


  </head>
  <body role="document">

    <div class="document">
  <div id="custom-doc" class="yui-t3">
    <div id="hd">
      
      <h1><a href="../../../../index.html">SoftBank Robotics documentation</a>
      
      
      <span><a class="whatsnew" href="../../../../news/index.html" >
      
          What's new in NAOqi 2.5?
      
      </a></span>
      
      </h1>
      <div id="global-nav">
        
        <a class="naoqi" title="NAOqi Developer guide" href="../../../../index_dev_guide.html">NAOqi</a>
        <a class="pepper" title="Pepper documentation" href="../../../../home_pepper.html">Pepper</a>
        <a class="nao" title="NAO documentation" href="../../../../home_nao.html">NAO</a>
        <a class="romeo" title="Romeo Documentation" href="../../../../home_romeo.html">Romeo</a>
        
        
        
        <div class="nav">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script></div>
      </div>

    </div>
    <main class="cd-container">
        <div id="bd">
          <div id="yui-main">
            <div class="yui-b">
              <div class="yui-g" id="dev-python-examples-almath-index">
                
  <div class="section" id="almath">
<span id="python-example-almath"></span><h1>ALMath<a class="headerlink" href="#almath" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="../../examples.html#python-examples"><span>&lt;&lt; return to Python examples</span></a></p>
<p>This section contains some examples showing how to use libalmath Python wrapping.
The C++ documentation of this library can be found <a class="reference internal" href="../../../../ref/cpp-api.html#libalmath-doc"><span>here</span></a>.
The wrapping allows to use all functions contained in this library, which is very
useful for computations related with motions (effectors positions for example).</p>
<div class="section" id="python-wrapping">
<h2>Python wrapping<a class="headerlink" href="#python-wrapping" title="Permalink to this headline">¶</a></h2>
<p>libalmath is wrapped in Python. This makes it possible for example to use this
library from Choregraphe, or from any Python script.</p>
<p>To import almath, use the following line (after having correctly configured
the Python SDK path if you are coding outside Choregraphe,
see <a class="reference internal" href="../../install_guide.html#python-install-guide"><span>Python SDK - Installation Guide</span></a> ):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">almath</span>
</pre></div>
</div>
<p>You can now call any method from libalmath with the following line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">almath</span><span class="o">.</span><span class="n">methodName</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Since libalmath is using particular types, you have to be careful to use
them correctly. This can cause some difficulties when interfacing with
other modules, such as ALMotion, which do not give the right format
directly.</p>
</div>
<div class="section" id="using-almath-with-almotion">
<h2>Using ALMath with ALMotion<a class="headerlink" href="#using-almath-with-almotion" title="Permalink to this headline">¶</a></h2>
<p>This example shows how to retrieve transforms from ALMotion
using the <a class="reference internal" href="../../../../naoqi/motion/control-cartesian-api.html#ALMotionProxy::getTransform__ssCR.iCR.bCR" title="ALMotionProxy::getTransform"><code class="xref cpp cpp-func docutils literal"><span class="pre">ALMotionProxy::getTransform</span></code></a> method, and how to
send transforms computed with ALMath back to ALMotion using
the <a class="reference internal" href="../../../../naoqi/motion/control-cartesian-api.html#ALMotionProxy::setTransform__ssCR.iCR.std::vector:float:CR.floatCR.iCR" title="ALMotionProxy::setTransform"><code class="xref cpp cpp-func docutils literal"><span class="pre">ALMotionProxy::setTransform</span></code></a> for example (but the principle
is still the same for other methods using transforms).</p>
<p><a class="reference download internal" href="../../../../_downloads/almath_transform.py"><code class="xref download docutils literal"><span class="pre">almath_transform.py</span></code></a></p>
<div class="highlight-py"><div class="highlight"><pre><span class="c">#! /usr/bin/env python</span>
<span class="c"># -*- encoding: UTF-8 -*-</span>

<span class="sd">&quot;&quot;&quot;Example: Show how to use almath with python and send the results to</span>
<span class="sd">    the robot by using a proxy to ALMotion&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">qi</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">almath</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Show how to use almath with python and send the results to</span>
<span class="sd">    the robot by using a proxy to ALMotion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Get the services AlMotion and ALRobotPosture.</span>

    <span class="n">motion_service</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&quot;ALMotion&quot;</span><span class="p">)</span>
    <span class="n">posture_service</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&quot;ALRobotPosture&quot;</span><span class="p">)</span>

    <span class="c"># WakeUp</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">wakeUp</span><span class="p">()</span>

    <span class="c"># Stand up.</span>
    <span class="n">posture_service</span><span class="o">.</span><span class="n">goToPosture</span><span class="p">(</span><span class="s">&quot;StandInit&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>

    <span class="n">chainName</span> <span class="o">=</span> <span class="s">&quot;RArm&quot;</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># FRAME_WORLD</span>
    <span class="n">useSensors</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c">##############################################</span>
    <span class="c"># Retrieve a transform matrix using ALMotion #</span>
    <span class="c">##############################################</span>

    <span class="c"># Retrieve current transform from ALMotion.</span>
    <span class="c"># Convert it to a transform matrix for ALMath.</span>
    <span class="n">origTransform</span> <span class="o">=</span> <span class="n">almath</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span>
        <span class="n">motion_service</span><span class="o">.</span><span class="n">getTransform</span><span class="p">(</span><span class="n">chainName</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">useSensors</span><span class="p">))</span>

    <span class="c"># Visualize the transform using overriden print from ALMath</span>
    <span class="k">print</span> <span class="s">&quot;Original transform&quot;</span>
    <span class="k">print</span> <span class="n">origTransform</span>

    <span class="c">##########################################################</span>
    <span class="c"># Use almath to do some computations on transform matrix #</span>
    <span class="c">##########################################################</span>

    <span class="c"># Compute a transform corresponding to the desired move</span>
    <span class="c"># (here, move the chain for 5cm along the Z axis and the X axis).</span>
    <span class="n">moveTransform</span> <span class="o">=</span> <span class="n">almath</span><span class="o">.</span><span class="n">Transform</span><span class="o">.</span><span class="n">fromPosition</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>

    <span class="c"># Compute the corresponding target transform.</span>
    <span class="n">targetTransform</span> <span class="o">=</span> <span class="n">moveTransform</span> <span class="o">*</span> <span class="n">origTransform</span>

    <span class="c"># Visualize it.</span>
    <span class="k">print</span> <span class="s">&quot;Target transform&quot;</span>
    <span class="k">print</span> <span class="n">targetTransform</span>

    <span class="c">##############################################</span>
    <span class="c"># Send a transform to the robot via ALMotion #</span>
    <span class="c">##############################################</span>

    <span class="c"># Convert it to a tuple.</span>
    <span class="n">targetTransformList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">targetTransform</span><span class="o">.</span><span class="n">toVector</span><span class="p">())</span>

    <span class="c"># Send the target transform to NAO through ALMotion.</span>
    <span class="n">fractionOfMaxSpeed</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">axisMask</span> <span class="o">=</span> <span class="n">almath</span><span class="o">.</span><span class="n">AXIS_MASK_VEL</span> <span class="c"># Translation X, Y, Z</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">setTransforms</span><span class="p">(</span>
        <span class="n">chainName</span><span class="p">,</span>
        <span class="n">frame</span><span class="p">,</span>
        <span class="n">targetTransformList</span><span class="p">,</span>
        <span class="n">fractionOfMaxSpeed</span><span class="p">,</span>
        <span class="n">axisMask</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">rest</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;--ip&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&quot;Robot IP address. On robot or Local Naoqi: use &#39;127.0.0.1&#39;.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;--port&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">9559</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&quot;Naoqi port number&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;tcp://&quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">&quot;Can&#39;t connect to Naoqi at ip </span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s"> on port &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot;Please check your script arguments. Run with -h option for help.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="using-almath-to-generate-footsteps">
<h2>Using ALMath to generate footsteps<a class="headerlink" href="#using-almath-to-generate-footsteps" title="Permalink to this headline">¶</a></h2>
<p>ALMath is widely used inside ALMotion. Using ALMath, you can then reproduce some
of the features included in ALMath, in particular concerning footsteps. If you
send any footstep to ALMotion, you will get a lot of warnings because they are
probably dangerous for the robot: they might cause foot collision or be too
long for NAO. If you want to generate footsteps without any warnings, you have
to clip them, using ALMath functionnalities.</p>
<p>The following example allows you to lead NAO by its arm. It generates footsteps
according to the left arm position, and then clips them to make sure they are
possible for NAO.</p>
<p>To use the example, launch the script giving your NAO&#8217;s IP as an argument. NAO
will stand up. When you are ready, take NAO&#8217;s left arm and press the front tactil
sensor. You can now guide NAO by inclining its arm forward and backwards, and
make him turn by turning his left wrist. NAO&#8217;s eyes will turn green when its arm
position gives him a target, and blue when the arm position is neutral. To end the
example, press the rear tactile sensor: NAO will crouch and remove its stiffness.</p>
<p>The code for the robot guide is the
following: <a class="reference download internal" href="../../../../_downloads/almath_robot_guide.py"><code class="xref download docutils literal"><span class="pre">almath_robot_guide.py</span></code></a>.
Do not forget to put the code for the foot clipping in the same
folder: <a class="reference download internal" href="../../../../_downloads/almath_foot_clip.py"><code class="xref download docutils literal"><span class="pre">almath_foot_clip.py</span></code></a>.</p>
<div class="highlight-py"><div class="highlight"><pre><span class="c">#! /usr/bin/env python</span>
<span class="c"># -*- encoding: UTF-8 -*-</span>

<span class="sd">&quot;&quot;&quot;Example : Show how to guide NAO by the hand&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">qi</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">almath</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">almath_foot_clip</span>

<span class="n">armName</span>     <span class="o">=</span> <span class="s">&quot;LArm&quot;</span>
<span class="n">lFootOffset</span> <span class="o">=</span> <span class="n">almath</span><span class="o">.</span><span class="n">Pose2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">rFootOffset</span> <span class="o">=</span> <span class="n">almath</span><span class="o">.</span><span class="n">Pose2D</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">stepSpeed</span>   <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">stepLength</span>  <span class="o">=</span> <span class="mf">0.05</span>

<span class="k">def</span> <span class="nf">initRobotPosition</span><span class="p">(</span><span class="n">motion_service</span><span class="p">,</span> <span class="n">posture_service</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inits NAO&#39;s position and stiffnesses to make the guiding possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">motion_service</span><span class="o">.</span><span class="n">wakeUp</span><span class="p">()</span>
    <span class="n">posture_service</span><span class="o">.</span><span class="n">goToPosture</span><span class="p">(</span><span class="s">&quot;StandInit&quot;</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">moveInit</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="c"># Make left arm loose.</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">setAngles</span><span class="p">(</span><span class="s">&quot;LWristYaw&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">setAngles</span><span class="p">(</span><span class="s">&quot;Head&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.44</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.44</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">setStiffnesses</span><span class="p">(</span><span class="n">armName</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">setStiffnesses</span><span class="p">(</span><span class="s">&quot;LWristYaw&quot;</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>

    <span class="c"># Disable arm moves while walking on left arm.</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">setMoveArmsEnabled</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">interpretJointsPose</span><span class="p">(</span><span class="n">motion_service</span><span class="p">,</span> <span class="n">memory_service</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Translates the current left arm pose into a target position</span>
<span class="sd">    for NAO&#39;s foot.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Retrieve current arm position.</span>
    <span class="n">armPose</span> <span class="o">=</span> <span class="n">motion_service</span><span class="o">.</span><span class="n">getAngles</span><span class="p">(</span><span class="n">armName</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

    <span class="n">targetX</span>     <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">targetY</span>     <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">targetTheta</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">gaitConfig</span> <span class="o">=</span> <span class="n">motion_service</span><span class="o">.</span><span class="n">getMoveConfig</span><span class="p">(</span><span class="s">&quot;Default&quot;</span><span class="p">)</span>

    <span class="c"># Filter Shoulder Pitch.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">armPose</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span> <span class="mf">0.9</span> <span class="ow">and</span> <span class="n">armPose</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.20</span><span class="p">):</span>
        <span class="n">targetX</span> <span class="o">=</span> <span class="n">stepLength</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">armPose</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">2.5</span> <span class="ow">and</span> <span class="n">armPose</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">):</span>
        <span class="n">targetX</span> <span class="o">=</span> <span class="o">-</span> <span class="n">stepLength</span> <span class="o">-</span> <span class="mf">0.02</span>

    <span class="c"># Filter Wrist Yaw.</span>
    <span class="k">if</span> <span class="n">armPose</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">:</span>
        <span class="n">targetTheta</span> <span class="o">=</span> <span class="n">gaitConfig</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">armPose</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">:</span>
        <span class="n">targetTheta</span> <span class="o">=</span> <span class="o">-</span> <span class="n">gaitConfig</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="c"># Return corresponding pose.</span>
    <span class="k">return</span> <span class="n">almath</span><span class="o">.</span><span class="n">Pose2D</span><span class="p">(</span><span class="n">targetX</span><span class="p">,</span> <span class="n">targetY</span><span class="p">,</span> <span class="n">targetTheta</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">moveToTargetPose</span><span class="p">(</span><span class="n">targetPose</span><span class="p">,</span> <span class="n">motion_service</span><span class="p">,</span> <span class="n">isLeftSupport</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Move to the desired target with the current foot.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">targetTf</span> <span class="o">=</span> <span class="n">almath</span><span class="o">.</span><span class="n">transformFromPose2D</span><span class="p">(</span><span class="n">targetPose</span><span class="p">)</span>

    <span class="c"># Compute foot position with the offset in NAOSpace.</span>
    <span class="k">if</span> <span class="n">isLeftSupport</span><span class="p">:</span>
        <span class="n">footTargetTf</span> <span class="o">=</span> <span class="n">targetTf</span> <span class="o">*</span> <span class="n">almath</span><span class="o">.</span><span class="n">transformFromPose2D</span><span class="p">(</span><span class="n">rFootOffset</span><span class="p">)</span>
        <span class="n">footTargetPose</span> <span class="o">=</span> <span class="n">almath</span><span class="o">.</span><span class="n">pose2DFromTransform</span><span class="p">(</span><span class="n">footTargetTf</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;RLeg&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">footTargetTf</span> <span class="o">=</span> <span class="n">targetTf</span> <span class="o">*</span> <span class="n">almath</span><span class="o">.</span><span class="n">transformFromPose2D</span><span class="p">(</span><span class="n">lFootOffset</span><span class="p">)</span>
        <span class="n">footTargetPose</span> <span class="o">=</span> <span class="n">almath</span><span class="o">.</span><span class="n">pose2DFromTransform</span><span class="p">(</span><span class="n">footTargetTf</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;LLeg&quot;</span><span class="p">]</span>

    <span class="c"># Clip the footstep to avoid collisions and too wide steps.</span>
    <span class="n">almath_foot_clip</span><span class="o">.</span><span class="n">clipFootStep</span><span class="p">(</span><span class="n">footTargetPose</span><span class="p">,</span> <span class="n">isLeftSupport</span><span class="p">)</span>

    <span class="n">step</span> <span class="o">=</span> <span class="p">[[</span><span class="n">footTargetPose</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">footTargetPose</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">footTargetPose</span><span class="o">.</span><span class="n">theta</span><span class="p">]]</span>
    <span class="n">speed</span> <span class="o">=</span> <span class="p">[</span><span class="n">stepSpeed</span><span class="p">]</span>

    <span class="c"># Send the footstep to NAO.</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">setFootStepsWithSpeed</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="c"># Change current foot.</span>
    <span class="n">isLeftSupport</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">isLeftSupport</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">session</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This example shows how to guide NAO by the hand, while computing his</span>
<span class="sd">    moves with only footsteps, using ALMath library. Footstep clipping is</span>
<span class="sd">    described in almath_foot_clip.py.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Get the services ALMemory, ALMotion, ALRobotPosture and ALLeds.</span>

    <span class="n">memory_service</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&quot;ALMemory&quot;</span><span class="p">)</span>
    <span class="n">motion_service</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&quot;ALMotion&quot;</span><span class="p">)</span>
    <span class="n">posture_service</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&quot;ALRobotPosture&quot;</span><span class="p">)</span>
    <span class="n">leds_service</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="s">&quot;ALLeds&quot;</span><span class="p">)</span>

    <span class="n">motion_service</span><span class="o">.</span><span class="n">setExternalCollisionProtectionEnabled</span><span class="p">(</span><span class="s">&quot;Move&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    <span class="c"># Init robot position.</span>
    <span class="n">initRobotPosition</span><span class="p">(</span><span class="n">motion_service</span><span class="p">,</span> <span class="n">posture_service</span><span class="p">)</span>

    <span class="c"># Wait for the user to press the front tactile sensor.</span>
    <span class="k">print</span> <span class="s">&quot;Please press head front tactile sensor to start.&quot;</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">memory_service</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="s">&quot;FrontTactilTouched&quot;</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">print</span> <span class="s">&quot;To guide the robot use the robot left arm.&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Move LShoulderPitch to set x, y target and move LWristYaw to set wz target.&quot;</span>
    <span class="k">print</span> <span class="s">&quot;When the robot eyes are green, the robot is ready to move.&quot;</span>

    <span class="k">print</span> <span class="s">&quot;Starting...&quot;</span>
    <span class="k">print</span> <span class="s">&quot;Please press head rear tactile sensor to stop.&quot;</span>

    <span class="c"># Start by moving left foot.</span>
    <span class="n">isLeftSupport</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">isMoving</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">leds_service</span><span class="o">.</span><span class="n">fadeRGB</span><span class="p">(</span><span class="s">&quot;FaceLeds&quot;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">memory_service</span><span class="o">.</span><span class="n">getData</span><span class="p">(</span><span class="s">&quot;RearTactilTouched&quot;</span><span class="p">):</span>
        <span class="n">targetPose</span> <span class="o">=</span> <span class="n">interpretJointsPose</span><span class="p">(</span><span class="n">motion_service</span><span class="p">,</span> <span class="n">memory_service</span><span class="p">)</span>
        <span class="c"># Filter the pose to avoid too small steps.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">targetPose</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">targetPose</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">)</span> <span class="ow">or</span> \
           <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">targetPose</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.08</span><span class="p">):</span>

            <span class="n">moveToTargetPose</span><span class="p">(</span><span class="n">targetPose</span><span class="p">,</span> <span class="n">motion_service</span><span class="p">,</span> <span class="n">isLeftSupport</span><span class="p">)</span>
            <span class="n">isLeftSupport</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">isLeftSupport</span>
            <span class="n">isMoving</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="c"># Set LEDs to green.</span>
            <span class="n">leds_service</span><span class="o">.</span><span class="n">fadeRGB</span><span class="p">(</span><span class="s">&quot;FaceLeds&quot;</span><span class="p">,</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">isMoving</span><span class="p">:</span>
            <span class="c"># Stop the robot.</span>
            <span class="n">motion_service</span><span class="o">.</span><span class="n">stopMove</span><span class="p">()</span>
            <span class="n">isMoving</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="c"># Set LEDs to blue.</span>
            <span class="n">leds_service</span><span class="o">.</span><span class="n">fadeRGB</span><span class="p">(</span><span class="s">&quot;FaceLeds&quot;</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="k">print</span> <span class="s">&quot;Stopping...&quot;</span>
    <span class="c"># Set LEDs to white.</span>
    <span class="n">leds_service</span><span class="o">.</span><span class="n">fadeRGB</span><span class="p">(</span><span class="s">&quot;FaceLeds&quot;</span><span class="p">,</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">+</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">+</span> <span class="mi">255</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="c"># Crouch.</span>
    <span class="n">motion_service</span><span class="o">.</span><span class="n">rest</span><span class="p">()</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;--ip&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;127.0.0.1&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&quot;Robot IP address. On robot or Local Naoqi: use &#39;127.0.0.1&#39;.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;--port&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">9559</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s">&quot;Naoqi port number&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">qi</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;tcp://&quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s">&quot;Can&#39;t connect to Naoqi at ip </span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">ip</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\&quot;</span><span class="s"> on port &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">port</span><span class="p">)</span> <span class="o">+</span><span class="s">&quot;.</span><span class="se">\n</span><span class="s">&quot;</span>
               <span class="s">&quot;Please check your script arguments. Run with -h option for help.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
</pre></div>
</div>
<p>The code for the foot clipping is the
following:</p>
<div class="highlight-py"><div class="highlight"><pre><span class="c">#! /usr/bin/env python</span>
<span class="c"># -*- encoding: UTF-8 -*-</span>

<span class="sd">&quot;&quot;&quot;Example: Use ALMath&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">almath</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This file shows how to use ALMath library in Python to clip</span>
<span class="sd">NAO footsteps to correct moves (avoiding too big steps and collision).</span>
<span class="sd">Use clipFootStep to clip your desired pose.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c"># Various parameters describing step characteristics.</span>
<span class="n">minFootSeparation</span> <span class="o">=</span> <span class="mf">0.088</span>
<span class="n">minStepX</span> <span class="o">=</span> <span class="o">-</span> <span class="mf">0.04</span>
<span class="n">maxStepX</span> <span class="o">=</span> <span class="mf">0.08</span>
<span class="n">maxStepY</span> <span class="o">=</span> <span class="mf">0.16</span>
<span class="n">maxStepTheta</span> <span class="o">=</span> <span class="mf">0.35</span>

<span class="k">def</span> <span class="nf">clipFootStepOnGaitConfig</span><span class="p">(</span><span class="n">footMove</span><span class="p">,</span> <span class="n">isLeftSupport</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Clip the foot move so that it does not exceed the maximum</span>
<span class="sd">        size of steps.</span>
<span class="sd">        footMove is an almath.Pose2D (x, y, theta position).</span>
<span class="sd">        isLeftSupport must be set to True if the move is on the right leg</span>
<span class="sd">        (the robot is supporting itself on the left leg).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">clipFloat</span><span class="p">(</span><span class="n">minValue</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Clip value between two extremes. &#39;&#39;&#39;</span>
        <span class="n">clipped</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">clipped</span> <span class="o">&lt;</span> <span class="n">minValue</span><span class="p">):</span>
            <span class="n">clipped</span> <span class="o">=</span> <span class="n">minValue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">clipped</span> <span class="o">&gt;</span> <span class="n">maxValue</span><span class="p">):</span>
            <span class="n">clipped</span> <span class="o">=</span> <span class="n">maxValue</span>
        <span class="k">return</span> <span class="n">clipped</span>

    <span class="c"># Clip X.</span>
    <span class="n">clippedX</span> <span class="o">=</span> <span class="n">clipFloat</span><span class="p">(</span><span class="n">minStepX</span><span class="p">,</span> <span class="n">maxStepX</span><span class="p">,</span> <span class="n">footMove</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">footMove</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">clippedX</span>

    <span class="c"># Clip Y.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isLeftSupport</span><span class="p">:</span>
        <span class="n">clippedY</span> <span class="o">=</span> <span class="n">clipFloat</span><span class="p">(</span><span class="n">minFootSeparation</span><span class="p">,</span> <span class="n">maxStepY</span><span class="p">,</span> <span class="n">footMove</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">clippedY</span> <span class="o">=</span> <span class="n">clipFloat</span><span class="p">(</span><span class="o">-</span><span class="n">maxStepY</span><span class="p">,</span> <span class="o">-</span> <span class="n">minFootSeparation</span><span class="p">,</span> <span class="n">footMove</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">clippedY</span>

    <span class="c"># Clip Theta.</span>
    <span class="n">clippedTheta</span> <span class="o">=</span> <span class="n">clipFloat</span><span class="p">(</span><span class="o">-</span><span class="n">maxStepTheta</span><span class="p">,</span> <span class="n">maxStepTheta</span><span class="p">,</span> <span class="n">footMove</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">footMove</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">clippedTheta</span>


<span class="k">def</span> <span class="nf">clipFootStepWithEllipse</span><span class="p">(</span><span class="n">footMove</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Clip the foot move inside an ellipse defined by the foot&#39;s dimansions.</span>
<span class="sd">        footMove is an almath.Pose2D (x, y, theta position).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c"># Apply an offset to have Y component of foot move centered on 0.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">minFootSeparation</span><span class="p">):</span>
        <span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">minFootSeparation</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">minFootSeparation</span><span class="p">):</span>
        <span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">minFootSeparation</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c"># Clip the foot move to an ellipse using ALMath method.</span>
    <span class="k">if</span> <span class="n">footMove</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">almath</span><span class="o">.</span><span class="n">clipFootWithEllipse</span><span class="p">(</span><span class="n">maxStepX</span><span class="p">,</span> <span class="n">maxStepY</span> <span class="o">-</span> <span class="n">minFootSeparation</span><span class="p">,</span> <span class="n">footMove</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">almath</span><span class="o">.</span><span class="n">clipFootWithEllipse</span><span class="p">(</span><span class="n">minStepX</span><span class="p">,</span> <span class="n">maxStepY</span> <span class="o">-</span> <span class="n">minFootSeparation</span><span class="p">,</span> <span class="n">footMove</span><span class="p">)</span>

    <span class="c"># Correct the previous offset on Y component.</span>
    <span class="k">if</span> <span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">footMove</span><span class="o">.</span><span class="n">y</span>  <span class="o">=</span> <span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">minFootSeparation</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">footMove</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">minFootSeparation</span>


<span class="k">def</span> <span class="nf">clipFootStepToAvoidCollision</span><span class="p">(</span><span class="n">footMove</span><span class="p">,</span> <span class="n">isLeftSupport</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Clip the foot move to avoid collision with the other foot.</span>
<span class="sd">        footMove is an almath.Pose2D (x, y, theta position).</span>
<span class="sd">        isLeftSupport must be set to True if the move is on the right leg</span>
<span class="sd">        (the robot is supporting itself on the left leg).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Bounding boxes of NAO&#39;s feet.</span>
    <span class="n">rFootBox</span> <span class="o">=</span> <span class="p">[</span><span class="n">almath</span><span class="o">.</span><span class="n">Position2D</span><span class="p">(</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.038</span><span class="p">),</span>    <span class="c"># rFootBoxFL</span>
                <span class="n">almath</span><span class="o">.</span><span class="n">Position2D</span><span class="p">(</span><span class="mf">0.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.050</span><span class="p">),</span>   <span class="c"># rFootBoxFR</span>
                <span class="n">almath</span><span class="o">.</span><span class="n">Position2D</span><span class="p">(</span><span class="o">-</span><span class="mf">0.047</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.050</span><span class="p">),</span> <span class="c"># rFootBoxRR</span>
                <span class="n">almath</span><span class="o">.</span><span class="n">Position2D</span><span class="p">(</span><span class="o">-</span><span class="mf">0.047</span><span class="p">,</span> <span class="mf">0.038</span><span class="p">)]</span>  <span class="c"># rFootBoxRL</span>
    <span class="n">lFootBox</span> <span class="o">=</span> <span class="p">[</span><span class="n">almath</span><span class="o">.</span><span class="n">Position2D</span><span class="p">(</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.050</span><span class="p">),</span>    <span class="c"># lFootBoxFL</span>
                <span class="n">almath</span><span class="o">.</span><span class="n">Position2D</span><span class="p">(</span><span class="mf">0.11</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.038</span><span class="p">),</span>   <span class="c"># lFootBoxFR</span>
                <span class="n">almath</span><span class="o">.</span><span class="n">Position2D</span><span class="p">(</span><span class="o">-</span><span class="mf">0.047</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.038</span><span class="p">),</span> <span class="c"># lFootBoxRR</span>
                <span class="n">almath</span><span class="o">.</span><span class="n">Position2D</span><span class="p">(</span><span class="o">-</span><span class="mf">0.047</span><span class="p">,</span>  <span class="mf">0.050</span><span class="p">)]</span> <span class="c"># lFootBoxRL</span>

    <span class="c"># Use ALMath method.</span>
    <span class="n">almath</span><span class="o">.</span><span class="n">avoidFootCollision</span><span class="p">(</span><span class="n">lFootBox</span><span class="p">,</span> <span class="n">rFootBox</span><span class="p">,</span> <span class="n">isLeftSupport</span><span class="p">,</span> <span class="n">footMove</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">clipFootStep</span><span class="p">(</span><span class="n">footMove</span><span class="p">,</span> <span class="n">isLeftSupport</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Clipping functions to avoid any warnings and undesired effects</span>
<span class="sd">        when sending the footsteps to ALMotion.</span>
<span class="sd">        footMove is an almath.Pose2D (x, y, theta position)</span>
<span class="sd">        isLeftSupport must be set to True if the move is on the right leg</span>
<span class="sd">        (the robot is supporting itself on the left leg).</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c"># First clip the foot move with gait config.</span>
    <span class="n">clipFootStepOnGaitConfig</span><span class="p">(</span><span class="n">footMove</span><span class="p">,</span> <span class="n">isLeftSupport</span><span class="p">)</span>
    <span class="c"># Then clip it on an ellipse.</span>
    <span class="n">clipFootStepWithEllipse</span><span class="p">(</span><span class="n">footMove</span><span class="p">)</span>
    <span class="c"># Then make sure you do not have any collision.</span>
    <span class="n">clipFootStepToAvoidCollision</span><span class="p">(</span><span class="n">footMove</span><span class="p">,</span> <span class="n">isLeftSupport</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          
            
              <div class="yui-b" id="sidebar">
                
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../contents.html">Site map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../news/index.html">What’s new</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index_dev_guide.html">NAOqi - Developer guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../getting_started/creating_applications/index.html">Creating an application</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ref/life/index.html">Programming for a living robot</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../getting_started/index_tuto.html">Other tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../../software/choregraphe/tutos/index.html">Choregraphe - Tutorials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../embedded/embedded_index.html">Working with NAOqi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tools/robot-simulation.html">Working with a simulated robot</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../tutorials.html">Python SDK - Tutorials</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../making_nao_speak.html">Using the API - Making NAO speak</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../making_nao_move.html">Parallel Tasks - Making NAO move and speak</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reacting_to_events.html">Reacting to events</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../processing_data.html">Logging data - Head angles</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../running_python_code_on_the_robot.html">Running Python code on the robot</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../examples.html">Python SDK - Examples</a><ul class="current">
<li class="toctree-l5"><a class="reference internal" href="../nonascii/index.html">Reading non-ASCII text</a></li>
<li class="toctree-l5"><a class="reference internal" href="../motion/index.html">Motion</a></li>
<li class="toctree-l5 current"><a class="current reference internal" href="">ALMath</a><ul class="simple">
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../sensors/index.html">Sensors</a></li>
<li class="toctree-l5"><a class="reference internal" href="../audio/index.html">Audio</a></li>
<li class="toctree-l5"><a class="reference internal" href="../vision/index.html">Vision</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../tips-and-tricks.html">Python SDK - Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../cpp/tutorials.html">C++ SDK - Tutorials</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../software/choregraphe/index.html">Choregraphe Suite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../programming_index.html">SDKs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../naoqi/index.html">NAOqi APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../libqi/index.html">qi Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ref/index.html">Former NAOqi Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../simulators/simulator_index.html">Simulators</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../home_nao.html"><strong>NAO</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../home_pepper.html"><strong>Pepper</strong> - Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../home_romeo.html"><strong>Romeo</strong> - Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../legal/notice.html">Legal notices</a></li>
</ul>

    <div id="on-this-page" style="display:none;">
        <h2 id="otp-link">On this page</h2>
        <div id="toc-list">
            <ul>
<li><a class="reference internal" href="#">ALMath</a><ul>
<li><a class="reference internal" href="#python-wrapping">Python wrapping</a></li>
<li><a class="reference internal" href="#using-almath-with-almotion">Using ALMath with ALMotion</a></li>
<li><a class="reference internal" href="#using-almath-to-generate-footsteps">Using ALMath to generate footsteps</a></li>
</ul>
</li>
</ul>

        </div>
    </div>
        </div>
      </div>
              </div>
            
          
        </div>
    </main>
    <a href="#0" class="cd-top"></a>
    <div id="ft">
      
      <a title="Glossary" href="../../../../glossary.html">Glossary</a>
      <a title="Site map" href="../../../../contents.html">Site map</a>
      <a title="Index" href="../../../../genindex.html">Index</a>
      <a title="Support" target="_blank" href="https://account.aldebaran.com/support/">Support</a>
      <a title="Contact" target="_blank" href="https://www.aldebaran.com/en/contact">Contact</a>
      <a title="Legal Notices" href="../../../../legal/notice.html">Legal Notices</a>
      
      
      <img src="https://www.ald.softbankrobotics.com/sites/aldebaran/files/logos-picture/2016_digital_logo_sbr_112x31_0.png" alt="">
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>